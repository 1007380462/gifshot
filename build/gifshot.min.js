!function(e,t,o,n){var i,a,s,c,d,u,l;i=function(){var r={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder,isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=o.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},console:function(){var t=e.console;return t&&r.isFunction(t.log)},webworkers:function(){var t=e.Worker;return r.isFunction(t)},blob:function(){return r.Blob}},log:function(){r.isSupported.console()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var o,n;if(r.isArray(e))for(o=-1,n=e.length;++o<n&&t(o,e[o])!==!1;);else if(r.isObject(e))for(o in e)if(e.hasOwnProperty(o)&&t(o,e[o])===!1)break},mergeOptions:function n(e,t){if(r.isObject(e)&&r.isObject(t)&&Object.keys){var o={};return r.each(e,function(t){o[t]=e[t]}),r.each(t,function(i){var a=t[i];o[i]=r.isObject(a)&&e[i]?n(e[i],a):a}),o}},setCSSAttr:function(e,t,o){r.isElement(e)&&(r.isString(t)&&r.isString(o)?e.style[t]=o:r.isObject(t)&&r.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){r.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},set:function(t,o){r.isSupported.localStorage()&&e.localStorage.setItem(t,o)},get:function(t){r.isSupported.localStorage()&&e.localStorage.getItem(t)},createWebWorker:function(t){if(!r.isString(t))return{};try{var o=new r.Blob([t],{type:"text/javascript"}),n=e.URL.createObjectURL(o),i=new Worker(n);return{objectUrl:n,worker:i}}catch(a){return{}}}};return r}(),a=function(){return{defaultVideoDimensions:{height:200,width:200},loadedData:!1,findVideoSize:function e(t){var r=t.videoElement,o=t.cameraStream,n=t.completedCallback;r&&(r.videoWidth>0&&r.videoHeight>0?(r.removeEventListener("loadeddata",this.findVideoSize),n({videoElement:r,cameraStream:o,videoWidth:r.videoWidth,videoHeight:r.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):n({videoElement:r,cameraStream:o,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){i.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=this,r=e.videoElement,o=e.cameraStream,n=e.streamedCallback,a=e.completedCallback;n(),r.mozSrcObject?r.mozSrcObject=o:i.URL&&(r.src=i.URL.createObjectURL(o)),r.play(),setTimeout(function s(){s.count=s.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:r,cameraStream:o,completedCallback:a}),t.loadedData=!1):(s.count+=1,s.count>10?t.findVideoSize({videoElement:r,cameraStream:o,completedCallback:a}):s())},100)},startStreaming:function(e){var t=this,r=i.isFunction(e.error)?e.error:i.noop,n=i.isFunction(e.streamed)?e.streamed:i.noop,a=i.isFunction(e.completed)?e.completed:i.noop,s=o.createElement("video"),c=e.lastCameraStream;s.autoplay=!0,s.addEventListener("loadeddata",function(){t.loadedData=!0}),c?t.stream({videoElement:s,cameraStream:c,streamedCallback:n,completedCallback:a}):i.getUserMedia({video:!0},function(e){t.stream({videoElement:s,cameraStream:e,streamedCallback:n,completedCallback:a})},r)},startVideoStreaming:function(e,t){t=t||{};var r,o=this,i=t.timeout!==n?t.timeout:0,a=t.callback;i>0&&(r=setTimeout(function(){o.onStreamingTimeout(a)},1e4)),this.startStreaming({error:function(){a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(t){var r=this.cameraStream=t.cameraStream,o=this.videoElement=t.videoElement,n=t.videoWidth,i=t.videoHeight;e({cameraStream:r,videoElement:o,videoWidth:n,videoHeight:i})},lastCameraStream:t.lastCameraStream})},stopVideoStreaming:function(e){e=i.isObject(e)?e:{};var t=e.cameraStream,r=e.videoElement,o=e.keepCameraOn;!o&&t&&i.isFunction(t.stop)&&t.stop(),i.isElement(r)&&(r.pause(),i.isFunction(i.URL.revokeObjectURL)&&i.URL.revokeObjectURL(r.src),i.removeElement(r))}}}(),s=function(){var e=function(){function e(e,t,r){for(var o=0,n=t*r*4,i=[];n>o;)i.push(e[o++]),i.push(e[o++]),i.push(e[o++]),o++;return i}function t(e){for(var t=[],r=0;r<e.length;r+=3){var o=e[r],n=e[r+1],i=e[r+2];t.push(o<<16|n<<8|i)}return t}function o(o,n,a,s){for(var c=e(o,n,a),d=new i(c,c.length,s),u=d.process(),l=new Uint32Array(t(u)),m=n*a,f=new Uint8Array(m),h=0,p=0;m>p;p++)r=c[h++],g=c[h++],b=c[h++],f[p]=d.map(r,g,b);return{pixels:f,palette:l}}function n(e){var t=e.width,r=e.height,n=e.data,i=(e.palette,e.sampleInterval);return o(n,t,r,i)}function i(){function e(e,t,r){var o,n;for(l=e,m=t,f=r,h=new Array(g),o=0;g>o;o++)h[o]=new Array(4),n=h[o],n[0]=n[1]=n[2]=(o<<k+8)/g|0,G[o]=F/g|0,V[o]=0}function t(){for(var e=[],t=new Array(g),r=0;g>r;r++)t[h[r][3]]=r;for(var o=0,n=0;g>n;n++){var i=t[n];e[o++]=h[i][0],e[o++]=h[i][1],e[o++]=h[i][2]}return e}function r(){var e,t,r,o,n,i,a,s;for(a=0,s=0,e=0;g>e;e++){for(n=h[e],r=e,o=n[1],t=e+1;g>t;t++)i=h[t],i[1]<o&&(r=t,o=i[1]);if(i=h[r],e!=r&&(t=i[0],i[0]=n[0],n[0]=t,t=i[1],i[1]=n[1],n[1]=t,t=i[2],i[2]=n[2],n[2]=t,t=i[3],i[3]=n[3],n[3]=t),o!=a){for(z[a]=s+e>>1,t=a+1;o>t;t++)z[t]=e;a=o,s=e}}for(z[a]=s+y>>1,t=a+1;256>t;t++)z[t]=y}function o(){var e,t,r,o,n,i,a,h,g,y,C,F,M,W;for(S>m&&(f=1),u=30+(f-1)/3,F=l,M=0,W=m,C=m/(3*f),y=C/U|0,h=x,i=H,a=i>>j,1>=a&&(a=0),e=0;a>e;e++)N[e]=h*((a*a-e*e)*B/(a*a));for(g=S>m?3:m%p!==0?3*p:m%v!==0?3*v:m%b!==0?3*b:3*w,e=0;C>e;)if(r=(255&F[M+0])<<k,o=(255&F[M+1])<<k,n=(255&F[M+2])<<k,t=d(r,o,n),c(h,t,r,o,n),0!==a&&s(a,t,r,o,n),M+=g,M>=W&&(M-=m),e++,0===y&&(y=1),e%y===0)for(h-=h/u,i-=i/L,a=i>>j,1>=a&&(a=0),t=0;a>t;t++)N[t]=h*((a*a-t*t)*B/(a*a))}function n(e,t,r){var o,n,i,a,s,c,d;for(s=1e3,d=-1,o=z[t],n=o-1;g>o||n>=0;)g>o&&(c=h[o],i=c[1]-t,i>=s?o=g:(o++,0>i&&(i=-i),a=c[0]-e,0>a&&(a=-a),i+=a,s>i&&(a=c[2]-r,0>a&&(a=-a),i+=a,s>i&&(s=i,d=c[3])))),n>=0&&(c=h[n],i=t-c[1],i>=s?n=-1:(n--,0>i&&(i=-i),a=c[0]-e,0>a&&(a=-a),i+=a,s>i&&(a=c[2]-r,0>a&&(a=-a),i+=a,s>i&&(s=i,d=c[3]))));return d}function i(){return o(),a(),r(),t()}function a(){var e;for(e=0;g>e;e++)h[e][0]>>=k,h[e][1]>>=k,h[e][2]>>=k,h[e][3]=e}function s(e,t,r,o,n){var i,a,s,c,d,u,l;for(s=t-e,-1>s&&(s=-1),c=t+e,c>g&&(c=g),i=t+1,a=t-1,u=1;c>i||a>s;){if(d=N[u++],c>i){l=h[i++];try{l[0]-=d*(l[0]-r)/P|0,l[1]-=d*(l[1]-o)/P|0,l[2]-=d*(l[2]-n)/P|0}catch(m){}}if(a>s){l=h[a--];try{l[0]-=d*(l[0]-r)/P|0,l[1]-=d*(l[1]-o)/P|0,l[2]-=d*(l[2]-n)/P|0}catch(m){}}}}function c(e,t,r,o,n){var i=h[t],a=e/x;i[0]-=a*(i[0]-r)|0,i[1]-=a*(i[1]-o)|0,i[2]-=a*(i[2]-n)|0}function d(e,t,r){var o,n,i,a,s,c,d,u,l,m;for(u=~(1<<31),l=u,c=-1,d=c,o=0;g>o;o++)m=h[o],n=m[0]-e,0>n&&(n=-n),i=m[1]-t,0>i&&(i=-i),n+=i,i=m[2]-r,0>i&&(i=-i),n+=i,u>n&&(u=n,c=o),a=n-(V[o]>>C-k),l>a&&(l=a,d=o),s=G[o]>>W,G[o]-=s,V[o]+=s<<M;return G[c]+=E,V[c]-=O,d}var u,l,m,f,h,g=256,p=499,v=491,b=487,w=503,S=3*w,y=g-1,k=4,U=100,C=16,F=1<<C,M=10,W=10,E=F>>W,O=F<<M-W,A=g>>3,j=6,I=1<<j,H=A*I,L=30,R=10,x=1<<R,T=8,B=1<<T,D=R+T,P=1<<D,z=[],V=[],G=[],N=[];e.apply(this,arguments);var K={};return K.map=n,K.process=i,K}self.onmessage=function(e){var t=e.data,r=n(t);postMessage(r)}},t=e.toString()+"worker();";return t}(),c=function(){function e(e,r,o,i){function a(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var s=0;i=i===n?{}:i;var c=i.loop===n?null:i.loop,d=i.palette===n?null:i.palette;if(0>=r||0>=o||r>65535||o>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var u=0,l=0;if(null!==d){for(var m=a(d);m>>=1;)++u;if(m=1<<u,--u,i.background!==n){if(l=i.background,l>=m)throw"Background index out of range.";if(0===l)throw"Background index explicitly passed as 0."}}if(e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&o,e[s++]=o>>8&255,e[s++]=(null!==d?128:0)|u,e[s++]=l,e[s++]=0,null!==d)for(var f=0,h=d.length;h>f;++f){var g=d[f];e[s++]=g>>16&255,e[s++]=g>>8&255,e[s++]=255&g}if(null!==c){if(0>c||c>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=0}var p=!1;this.addFrame=function(r,o,i,c,u,l){if(p===!0&&(--s,p=!1),l=l===n?{}:l,0>r||0>o||r>65535||o>65535)throw"x/y invalid.";if(0>=i||0>=c||i>65535||c>65535)throw"Width/Height invalid.";if(u.length<i*c)throw"Not enough pixels for the frame size.";var m=!0,f=l.palette;if((f===n||null===f)&&(m=!1,f=d),f===n||null===f)throw"Must supply either a local or global palette.";for(var h=a(f),g=0;h>>=1;)++g;h=1<<g;var v=l.delay===n?0:l.delay,b=l.disposal===n?0:l.disposal;if(0>b||b>3)throw"Disposal out of range.";var w=!1,S=0;if(l.transparent!==n&&null!==l.transparent&&(w=!0,S=l.transparent,0>S||S>=h))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(w===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=S,e[s++]=0),e[s++]=44,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&o,e[s++]=o>>8&255,e[s++]=255&i,e[s++]=i>>8&255,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=m===!0?128|g-1:0,m===!0)for(var y=0,k=f.length;k>y;++y){var U=f[y];e[s++]=U>>16&255,e[s++]=U>>8&255,e[s++]=255&U}s=t(e,s,2>g?2:g,u)},this.end=function(){return p===!1&&(e[s++]=59,p=!0),s}}function t(e,t,r,o){function i(r){for(;f>=r;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){h|=e<<f,f+=m,i(8)}e[t++]=r;var s=t++,c=1<<r,d=c-1,u=c+1,l=u+1,m=r+1,f=0,h=0,g=o[0]&d,p={};a(c);for(var v=1,b=o.length;b>v;++v){var w=o[v]&d,S=g<<8|w,y=p[S];if(y===n){for(h|=g<<f,f+=m;f>=8;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===l?(a(c),l=u+1,m=r+1,p={}):(l>=1<<m&&++m,p[S]=l++),g=w}else g=y}return a(g),a(u),i(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}return e}(),d=function(e){function t(t){function r(){if(0===O.length)throw"No workers left!";return O.pop()}function n(e){O.push(e)}function a(e){C.length;M=e;for(var t=0;f>t&&t<C.length;t++)s(t)}function s(e){var t,o;return t=C[e],t.beingProcessed||t.done?(console.error("Frame already being processed or done!",t.position),void u()):(t.sampleInterval=m,t.beingProcessed=!0,o=r(),o.onmessage=function(e){var r=e.data;delete t.data,t.pixels=Array.prototype.slice.call(r.pixels),t.palette=Array.prototype.slice.call(r.palette),t.done=!0,t.beingProcessed=!1,n(o),u()},void o.postMessage(t))}function d(){for(var e=-1,t=0;t<C.length;t++){var r=C[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&s(e)}function u(){var e=C.every(function(e){return!e.beingProcessed&&e.done});F++,W(.75*F/C.length),e?A||l(C,M):setTimeout(d,1)}function l(e,t){var r,o=[],n={loop:k};null!==b&&null!==w&&(r=w,n.palette=r);var i=new g(o,p,v,n);A=!0,e.forEach(function(t){var o;r||(o=t.palette),W(.75+.25*t.position*1/e.length),i.addFrame(0,0,p,v,t.pixels,{palette:o,delay:U})}),i.end(),W(1),e=[],A=!1,t(o)}var m,f,h,g=c,p=t.width||160,v=t.height||120,b=t.dithering||null,w=t.palette||null,S=null,y=null,k=0,U=250,C=[],F=0,M=function(){},W=function(){},E=[],O=[],A=!1;t=t||{},m=t.sampleInterval||10,f=t.numWorkers||2,h=t.workerPath||"Animated_GIF.worker.js";for(var j=0;f>j;j++){var I=i.createWebWorker(e),H=I.worker;E.push(H),O.push(H)}var L=function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return function(t){for(var r=t.length,o="",n=0;r>n;n++)o+=e[t[n]];return o}}();this.setSize=function(e,t){p=e,v=t,S=o.createElement("canvas"),S.width=e,S.height=t,y=S.getContext("2d")},this.setDelay=function(e){U=.1*e},this.setRepeat=function(e){k=e},this.addFrame=function(e){null===y&&this.setSize(p,v),y.drawImage(e,0,0,p,v);var t=y.getImageData(0,0,p,v);this.addFrameImageData(t)},this.addFrameImageData=function(e){var t=(e.length,new Uint8Array(e.data));C.push({data:t,width:e.width,height:e.height,palette:w,dithering:b,done:!1,beingProcessed:!1,position:C.length})},this.onRenderProgress=function(e){W=e},this.isRendering=function(){return A},this.getBase64GIF=function(e){var t=function(t){var r=L(t),o="data:image/gif;base64,"+btoa(r);e(o)};a(t)},this.getBlobGIF=function(e){var t=function(t){var r=new Uint8Array(t),o=new Blob([r],{type:"image/gif"});e(o)};a(t)},this.destroy=function(){E.forEach(function(e){e.terminate()})}}return t}(s),u=function(e){return{getWebcamGif:function(t,r){r=i.isFunction(r)?r:function(){};var a,s=o.createElement("canvas"),c=t.videoElement,d=t.cameraStream,u=t.gifWidth,l=t.gifHeight,m=t.videoWidth,f=t.videoHeight,h=t.sampleInterval,g=t.numWorkers,p=t.crop,v=t.interval,b=t.progressCallback,w=t.numFrames,S=w,y=new e({sampleInterval:h,numWorkers:g}),k=Math.floor(p.scaledWidth/2),U=m-p.scaledWidth,C=Math.floor(p.scaledHeight/2),F=f-p.scaledHeight,M=function(){var e=S-1;a.drawImage(c,k,C,U,F,0,0,u,l),y.addFrameImageData(a.getImageData(0,0,u,l)),S=e,b((w-S)/w),e>0&&setTimeout(M,1e3*v),S||y.getBase64GIF(function(e){y.destroy(),r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:d,videoElement:c})})};w=w!==n?w:3,v=v!==n?v:.1,s.width=u,s.height=l,a=s.getContext("2d"),y.setSize(u,l),y.setDelay(v),M()},getCropDimensions:function(e){var t=e.videoWidth,r=e.videoHeight,o=e.gifWidth,n=e.gifHeight,i={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(i.width=Math.round(t*(n/r))-o,i.scaledWidth=Math.round(i.width*(r/n))):(i.height=Math.round(r*(o/t))-n,i.scaledHeight=Math.round(i.height*(t/o))),i}}}(d),l=function(){var t={defaultOptions:{gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,progressCallback:function(){},completeCallback:function(){}},options:{},createGIF:function(r,n){if(r=i.isObject(r)?r:{},n=i.isFunction(r)?r:n,i.isFunction(n)){if(!t.isSupported())return n(i.isFunction(i.getUserMedia)?i.isSupported.canvas()?i.isSupported.webworkers()?i.URL?i.isSupported.blob()?i.isFunction(e.btoa)?i.isFunction(Uint8Array)?i.isFunction(Uint32Array)?{error:!0,errorCode:"unknown",errorMsg:"Unknown error",image:null,cameraStream:{}}:{error:!0,errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"window.btoa",errorMsg:"The window.btoa base-64 encoding method is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser",image:null,cameraStream:{}}:{error:!0,errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser",image:null,cameraStream:{}});var s=t.defaultOptions,c=this.options=i.mergeOptions(s,r),d=r.cameraStream,l=(c.numFrames,c.interval),m=1e4*l;a.startVideoStreaming(function(e){var r=e.cameraStream,a=e.videoElement,s=e.videoWidth,d=e.videoHeight,l=c.gifWidth,f=c.gifHeight,h=u.getCropDimensions({videoWidth:s,videoHeight:d,gifHeight:f,gifWidth:l}),g=n;c.crop=h,c.videoElement=a,c.videoWidth=s,c.videoHeight=d,c.cameraStream=r,i.isElement(a)&&(a.src=i.URL.createObjectURL(r),a.width=l+h.width,a.height=f+h.height,i.setCSSAttr(a,{position:"absolute",width:l+h.videoWidth+"px",height:f+h.videoHeight+"px",left:-Math.floor(h.videoWidth/2)+"px",top:-Math.floor(h.videoHeight/2)+"px",opacity:"0"}),o.body.appendChild(a),a.play(),setTimeout(function(){u.getWebcamGif(c,function(e){t.stopVideoStreaming(e),e.videoElement&&delete e.videoElement,g(e)})},m))},{lastCameraStream:d,callback:n})}},takeSnapShot:function(e,r){var o=i.mergeOptions(t.defaultOptions,e),n=i.mergeOptions(o,{interval:.1,numFrames:1});this.createGIF(n,r)},stopVideoStreaming:function(e){e=i.isObject(e)?e:{};var t=this,r=i.isObject(t.options)?t.options:{},o=e.cameraStream,n=e.videoElement;a.stopVideoStreaming({cameraStream:o,videoElement:n,keepCameraOn:r.keepCameraOn})},isSupported:function(){return i.isFunction(i.getUserMedia)&&i.isSupported.canvas()&&i.isSupported.webworkers()&&i.URL&&i.isSupported.blob()&&i.isFunction(e.btoa)&&i.isFunction(Uint8Array)&&i.isFunction(Uint32Array)}};"function"==typeof define&&define.amd?define("gifshot",[],function(){return t}):"undefined"!=typeof exports?module.exports=t:e.gifshot=t}()}(window,window.navigator,document);