!function(e,t,i,r){var n,o,a,d;n={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isCanvasSupported:function(){var e=i.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isConsoleSupported:function(){var t=e.console;return t&&this.isFunction(t.log)},log:function(){this.isConsoleSupported()&&console.log.apply(e.console,arguments)},noop:function(){}},o=function(){return{videoElement:r,cameraStream:r,defaultVideoDimensions:{height:640,width:480},findVideoSize:function e(t){var i=t.videoElement,r=t.cameraStream,n=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",this.findVideoSize),n({videoElement:i,cameraStream:r,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):n({videoElement:i,cameraStream:r,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){e(new Error("Timed out while trying to start streaming"))},errorCallback:function(e){new Error("getUserMedia cannot access the camera",e)},startStreaming:function(e){var t,r=this,o=n.isFunction(e.error)?e.error:n.noop,a=n.isFunction(e.streamed)?e.streamed:n.noop,d=n.isFunction(e.completed)?e.completed:n.noop,l=i.createElement("video");l.autoplay=!0,l.addEventListener("loadeddata",function(){r.loadedData=!0}),n.getUserMedia({video:!0},function(e){a(),l.mozSrcObject?l.mozSrcObject=e:n.URL&&(l.src=n.URL.createObjectURL(e)),t=e,l.play(),setTimeout(function i(){i.count=i.count||0,r.loadedData===!0?(r.findVideoSize({videoElement:l,cameraStream:t,completedCallback:d}),r.loadedData=!1):(i.count+=1,i.count>10?r.findVideoSize({videoElement:l,cameraStream:t,completedCallback:d}):i())},100)},o)},startVideoStreaming:function(e,t){t=t||{};var i,o=this,a=t.timeout!==r?t.timeout:0;n.isFunction(n.getUserMedia)?(a>0&&(i=setTimeout(function(){o.onStreamingTimeout(e)},1e4)),this.startStreaming({error:o.errorCallback,streamed:function(){clearTimeout(i)},completed:function(t){var i=this.videoElement=t.videoElement,r=this.cameraStream=t.cameraStream,n=t.videoWidth,o=t.videoHeight;e(r,i,n,o)}})):e(new Error("Native device media streaming (getUserMedia) not supported in this browser."))},stopVideoStreaming:function(){var e=this.cameraStream,t=this.videoElement;e&&e.stop(),t&&(t.pause(),t.src=null,t=null)}}}(),a=function(){function e(e,i,n,o){function a(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var d=0;o=o===r?{}:o;var l=o.loop===r?null:o.loop,s=o.palette===r?null:o.palette;if(0>=i||0>=n||i>65535||n>65535)throw"Width/Height invalid.";e[d++]=71,e[d++]=73,e[d++]=70,e[d++]=56,e[d++]=57,e[d++]=97;var c=0,u=0;if(null!==s){for(var f=a(s);f>>=1;)++c;if(f=1<<c,--c,o.background!==r){if(u=o.background,u>=f)throw"Background index out of range.";if(0===u)throw"Background index explicitly passed as 0."}}if(e[d++]=255&i,e[d++]=i>>8&255,e[d++]=255&n,e[d++]=n>>8&255,e[d++]=(null!==s?128:0)|c,e[d++]=u,e[d++]=0,null!==s)for(var h=0,v=s.length;v>h;++h){var m=s[h];e[d++]=m>>16&255,e[d++]=m>>8&255,e[d++]=255&m}if(null!==l){if(0>l||l>65535)throw"Loop count invalid.";e[d++]=33,e[d++]=255,e[d++]=11,e[d++]=78,e[d++]=69,e[d++]=84,e[d++]=83,e[d++]=67,e[d++]=65,e[d++]=80,e[d++]=69,e[d++]=50,e[d++]=46,e[d++]=48,e[d++]=3,e[d++]=1,e[d++]=255&l,e[d++]=l>>8&255,e[d++]=0}var g=!1;this.addFrame=function(i,n,o,l,c,u){if(g===!0&&(--d,g=!1),u=u===r?{}:u,0>i||0>n||i>65535||n>65535)throw"x/y invalid.";if(0>=o||0>=l||o>65535||l>65535)throw"Width/Height invalid.";if(c.length<o*l)throw"Not enough pixels for the frame size.";var f=!0,h=u.palette;if((h===r||null===h)&&(f=!1,h=s),h===r||null===h)throw"Must supply either a local or global palette.";for(var v=a(h),m=0;v>>=1;)++m;v=1<<m;var p=u.delay===r?0:u.delay,w=u.disposal===r?0:u.disposal;if(0>w||w>3)throw"Disposal out of range.";var b=!1,S=0;if(u.transparent!==r&&null!==u.transparent&&(b=!0,S=u.transparent,0>S||S>=v))throw"Transparent color index.";if((0!==w||b||0!==p)&&(e[d++]=33,e[d++]=249,e[d++]=4,e[d++]=w<<2|(b===!0?1:0),e[d++]=255&p,e[d++]=p>>8&255,e[d++]=S,e[d++]=0),e[d++]=44,e[d++]=255&i,e[d++]=i>>8&255,e[d++]=255&n,e[d++]=n>>8&255,e[d++]=255&o,e[d++]=o>>8&255,e[d++]=255&l,e[d++]=l>>8&255,e[d++]=f===!0?128|m-1:0,f===!0)for(var k=0,y=h.length;y>k;++k){var x=h[k];e[d++]=x>>16&255,e[d++]=x>>8&255,e[d++]=255&x}d=t(e,d,2>m?2:m,c)},this.end=function(){return g===!1&&(e[d++]=59,g=!0),d}}function t(e,t,i,n){function o(i){for(;h>=i;)e[t++]=255&v,v>>=8,h-=8,t===d+256&&(e[d]=255,d=t++)}function a(e){v|=e<<h,h+=f,o(8)}e[t++]=i;var d=t++,l=1<<i,s=l-1,c=l+1,u=c+1,f=i+1,h=0,v=0,m=n[0]&s,g={};a(l);for(var p=1,w=n.length;w>p;++p){var b=n[p]&s,S=m<<8|b,k=g[S];if(k===r){for(v|=m<<h,h+=f;h>=8;)e[t++]=255&v,v>>=8,h-=8,t===d+256&&(e[d]=255,d=t++);4096===u?(a(l),u=c+1,f=i+1,g={}):(u>=1<<f&&++f,g[S]=u++),m=b}else m=k}return a(m),a(c),o(1),d+1===t?e[d]=0:(e[d]=t-d-1,e[t++]=0),t}function i(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||57!==e[t++]||97!==e[t++])throw"Invalid GIF 89a header.";{var i=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,o=e[t++],a=o>>7,d=7&o,l=1<<d+1;e[t++]}e[t++];var s=null;a&&(s=t,t+=3*l);var c=null,u=!0,f=[],h=0,v=null,m=0;for(c=null,this.width=i,this.height=r;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0===e[t+16])t+=14,c=e[t++]|e[t++]<<8,t++;else for(t+=12;;){var g=e[t++];if(0===g)break;t+=g}break;case 249:if(4!==e[t++]||0!==e[t+4])throw"Invalid graphics extension block.";var p=e[t++];h=e[t++]|e[t++]<<8,v=e[t++],0===(1&p)&&(v=null),m=p>>2&7,t++;break;case 254:for(;;){var g=e[t++];if(0===g)break;t+=g}break;default:throw"Unknown graphic control label: 0x"+e[t-1].toString(16)}break;case 44:var w=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,S=e[t++]|e[t++]<<8,k=e[t++]|e[t++]<<8,y=e[t++],x=y>>7,U=7&y,E=1<<U+1,C=s,R=!1;x&&(R=!0,C=t,t+=3*E);var W=t;for(t++;;){var g=e[t++];if(0===g)break;t+=g}f.push({x:w,y:b,width:S,height:k,has_local_palette:R,palette_offset:C,data_offset:W,data_length:t-W,transparent_index:v,delay:h,disposal:m});break;case 59:u=!1;break;default:throw"Unknown gif block: 0x"+e[t-1].toString(16)}this.numFrames=function(){return f.length},this.frameInfo=function(e){if(0>e||e>=f.length)throw"Frame index out of range.";return f[e]},this.decodeAndBlitFrameBGRA=function(t,r){var o=this.frameInfo(t),a=o.width*o.height,d=new Uint8Array(a);n(e,o.data_offset,d,a);var l=o.palette_offset,s=o.transparent_index;null===s&&(s=256);for(var c=4*(i-o.width),u=4*(o.y*i+o.x),f=o.width,h=0,v=d.length;v>h;++h){var m=d[h];if(m===s)u+=4;else{var g=e[l+3*m],p=e[l+3*m+1],w=e[l+3*m+2];r[u++]=w,r[u++]=p,r[u++]=g,r[u++]=255}0===--f&&(u+=c,f=o.width)}},this.decodeAndBlitFrameRGBA=function(t,r){var o=this.frameInfo(t),a=o.width*o.height,d=new Uint8Array(a);n(e,o.data_offset,d,a);var l=0,s=o.palette_offset,c=o.transparent_index;null===c&&(c=256);var u=4*(i-o.width),f=o.width;l=4*(o.y*i+o.x);for(var h=0,v=d.length;v>h;++h){var m=d[h];if(m===c)l+=4;else{var g=e[s+3*m],p=e[s+3*m+1],w=e[s+3*m+2];r[l++]=g,r[l++]=p,r[l++]=w,r[l++]=255}0===--f&&(l+=u,f=o.width)}}}function n(e,t,i,r){for(var n=e[t++],o=1<<n,a=o+1,d=a+1,l=n+1,s=(1<<l)-1,c=0,u=0,f=0,h=e[t++],v=new Int32Array(4096),m=null;;){for(;16>c&&0!==h;)u|=e[t++]<<c,c+=8,1===h?h=e[t++]:--h;if(l>c)break;var g=u&s;if(u>>=l,c-=l,g!==o){if(g===a)break;for(var p=d>g?g:m,w=0,b=p;b>o;)b=v[b]>>8,++w;var S=b,k=f+w+(p!==g?1:0);if(k>r)return void console.log("Warning, gif stream longer than expected.");i[f++]=S,f+=w;var y=f;for(p!==g&&(i[f++]=S),b=p;w--;)b=v[b],i[--y]=255&b,b>>=8;null!==m&&4096>d&&(v[d++]=m<<8|S,d>=s+1&&12>l&&(++l,s=s<<1|1)),m=g}else d=a+1,l=n+1,s=(1<<l)-1,m=null}return f!==r&&console.log("Warning, gif stream shorter than expected."),i}return{GifWriter:e,GifReader:i}}(),d=function(e){o.startVideoStreaming(function(t,r){function o(){var e;t&&(d.width=r.videoWidth,d.height=r.videoHeight,e=context.getImageData(0,0,r.videoWidth,r.videoHeight),s.push(e),codec=new a.GifWriter(e,r.videoWidth,r.videoHeight),console.log(codec))}var d,l,s=[];return e.isCanvasSupported()?(l=i.createElement("img"),d=i.createElement("canvas"),context=d.getContext("2d"),r.onclick=o,i.body.appendChild(r),void i.body.appendChild(l)):void n.log("ERROR: Canvas not supported")})}(n)}(window,window.navigator,document);