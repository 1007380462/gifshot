!function(e,t,i,a){var o,n,r,d;o={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),isLocalStorage:function(){try{return"localStorage"in e&&null!==e.localStorage}catch(t){return!1}},isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isCanvasSupported:function(){var e=i.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isConsoleSupported:function(){var t=e.console;return t&&this.isFunction(t.log)},log:function(){this.isConsoleSupported()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var i,a;if(this.isArray(e))for(i=-1,a=e.length;++i<a&&t(i,e[i])!==!1;);else if(this.isObject(e))for(i in e)if(e.hasOwnProperty(i)&&t(i,e[i])===!1)break},mergeOptions:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},setCSSAttr:function(e,t,i){this.isElement(e)&&(this.isString(t)&&this.isString(i)?e.style[t]=i:this.isObject(t)&&this.each(t,function(t,i){e.style[t]=i}))},set:function(t,i){this.isLocalStorage()&&e.localStorage.setItem(t,i)},get:function(t){this.isLocalStorage()&&e.localStorage.getItem(t)}},n=function(){return{videoElement:a,cameraStream:a,defaultVideoDimensions:{height:640,width:480},findVideoSize:function e(t){var i=t.videoElement,a=t.cameraStream,o=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",this.findVideoSize),o({videoElement:i,cameraStream:a,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):o({videoElement:i,cameraStream:a,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){o.log("Timed out while trying to start streaming"),o.isFunction(e)&&e({})},errorCallback:function(e){o.log("getUserMedia cannot access the camera"),o.isFunction(e)&&e({})},stream:function(e){var t=this,i=e.videoElement,a=e.cameraStream,n=e.streamedCallback,r=e.completedCallback;n(),i.mozSrcObject?i.mozSrcObject=a:o.URL&&(i.src=o.URL.createObjectURL(a)),i.play(),setTimeout(function d(){d.count=d.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:i,cameraStream:a,completedCallback:r}),t.loadedData=!1):(d.count+=1,d.count>10?t.findVideoSize({videoElement:i,cameraStream:a,completedCallback:r}):d())},100)},startStreaming:function(e){var t=this,a=o.isFunction(e.error)?e.error:o.noop,n=o.isFunction(e.streamed)?e.streamed:o.noop,r=o.isFunction(e.completed)?e.completed:o.noop,d=i.createElement("video"),s=e.lastCameraStream;d.autoplay=!0,d.addEventListener("loadeddata",function(){t.loadedData=!0}),s?t.stream({videoElement:d,cameraStream:s,streamedCallback:n,completedCallback:r}):o.getUserMedia({video:!0},function(e){t.stream({videoElement:d,cameraStream:e,streamedCallback:n,completedCallback:r})},a)},startVideoStreaming:function(e,t){t=t||{};var i,n=this,r=t.timeout!==a?t.timeout:0;o.isFunction(o.getUserMedia)?(r>0&&(i=setTimeout(function(){n.onStreamingTimeout(e)},1e4)),this.startStreaming({error:function(){n.errorCallback(e)},streamed:function(){clearTimeout(i)},completed:function(t){var i=this.cameraStream=t.cameraStream,a=this.videoElement=t.videoElement,o=t.videoWidth,n=t.videoHeight;e({cameraStream:i,videoElement:a,videoWidth:o,videoHeight:n})},lastCameraStream:t.lastCameraStream})):(o.log("Native device media streaming (getUserMedia) not supported in this browser."),e({}))},stopVideoStreaming:function(e){e=o.isObject(e)?e:{};var t=e.cameraStream||this.cameraStream,i=e.videoElement||this.videoElement;t&&t.stop(),i&&(i.pause(),i.src=null,i=null)}}}(),r=function(){return{getWebcamGif:function(e,t){if(t=o.isFunction(t)?t:function(){},!o.isCanvasSupported())return o.log("ERROR: Canvas not supported"),void t();var n,r=i.createElement("canvas"),d=e.videoElement,s=e.gifWidth,c=e.gifHeight,m=e.videoWidth,l=e.videoHeight,u=e.crop,h=e.interval,g=e.progressCallback,f=e.numFrames,v=f,p=new Animated_GIF({workerPath:"src/vendor/Animated_GIF.worker.js"}),S=Math.floor(u.scaledWidth/2),b=m-u.scaledWidth,C=Math.floor(u.scaledHeight/2),y=l-u.scaledHeight,E=function(){var e=v-1;f!==e+1&&(n.drawImage(d,S,C,b,y,0,0,s,c),p.addFrameImageData(n.getImageData(0,0,s,c))),v=e,g((f-v)/f),e>0&&setTimeout(E,1e3*h),v||p.getBase64GIF(function(e){p.destroy(),t(e)})};f=f!==a?f:3,h=h!==a?h:.1,r.width=s,r.height=c,n=r.getContext("2d"),p.setSize(s,c),p.setDelay(h),E()},getCropDimensions:function(e){var t=e.videoWidth,i=e.videoHeight,a=e.gifWidth,o=e.gifHeight,n={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>i?(n.width=Math.round(t*(o/i))-a,n.scaledWidth=Math.round(n.width*(i/o))):(n.height=Math.round(i*(a/t))-o,n.scaledHeight=Math.round(n.height*(t/a))),n}}}(),d=function(){var t,a,d={defaultOptions:{gifWidth:640,gifHeight:480,interval:.2,numFrames:10,progressCallback:function(){},completeCallback:function(){}},createGIF:function(e,s){e=o.isObject(e)?e:{},s=o.isFunction(e)?e:s;var c=this,m=d.defaultOptions,l=o.mergeOptions(m,e);n.startVideoStreaming(function(e){var n=e.cameraStream,d=e.videoElement,m=e.videoWidth,u=e.videoHeight,h=l.gifWidth,g=l.gifHeight,f=r.getCropDimensions({videoWidth:m,videoHeight:u,gifHeight:g,gifWidth:h}),v=s;t=n,a=d,l.crop=f,l.videoElement=d,l.videoWidth=m,l.videoHeight=u,o.isElement(d)&&(d.src=o.URL.createObjectURL(n),d.width=h+f.width,d.height=g+f.height,o.setCSSAttr(d,{position:"absolute",width:h+f.videoWidth+"px",height:g+f.videoHeight+"px",left:-Math.floor(f.videoWidth/2)+"px",top:-Math.floor(f.videoHeight/2)+"px",opacity:"0"}),i.body.appendChild(d),d.play(),r.getWebcamGif(l,function(){c.stopVideoStreaming(),v.apply(this,arguments)}))},{lastCameraStream:t})},takeSnapShot:function(e){this.createGIF({interval:.1,numFrames:2},e)},stopVideoStreaming:function(e){e=o.isObject(e)?e:{};var i=e.cameraStream||t,r=e.videoElement||a;n.stopVideoStreaming({cameraStream:i,videoElement:r})},startVideoStreaming:function(e){e=o.isObject(e)?e:{};var i=e.cameraStream||t,r=e.videoElement||a;n.startVideoStreaming({cameraStream:i,videoElement:r})}};"function"==typeof define&&define.amd?define("gifshot",[],function(){return d}):"undefined"!=typeof exports?module.exports=d:e.gifshot=d}()}(window,window.navigator,document);