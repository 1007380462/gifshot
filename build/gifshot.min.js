!function(e,t,i,o){var n,r,a;n={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},noop:function(){}},r=function(){return{videoElement:o,cameraStream:o,defaultVideoDimensions:{height:640,width:480},findVideoSize:function e(t){var i=t.videoElement,o=t.cameraStream,n=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",this.findVideoSize),n({videoElement:i,cameraStream:o,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):n({videoElement:i,cameraStream:o,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){e(new Error("Timed out while trying to start streaming"))},errorCallback:function(e){new Error("getUserMedia cannot access the camera",e)},startStreaming:function(e){var t,o=this,r=n.isFunction(e.error)?e.error:n.noop,a=n.isFunction(e.streamed)?e.streamed:n.noop,d=n.isFunction(e.completed)?e.completed:n.noop,c=i.createElement("video");c.autoplay=!0,c.addEventListener("loadeddata",function(){o.loadedData=!0}),n.getUserMedia({video:!0},function(e){a(),c.mozSrcObject?c.mozSrcObject=e:n.URL&&(c.src=n.URL.createObjectURL(e)),t=e,c.play(),setTimeout(function i(){i.count=i.count||0,o.loadedData===!0?(o.findVideoSize({videoElement:c,cameraStream:t,completedCallback:d}),o.loadedData=!1):(i.count+=1,i.count>10?o.findVideoSize({videoElement:c,cameraStream:t,completedCallback:d}):i())},100)},r)},startVideoStreaming:function(e,t){t=t||{};var i,r=this,a=t.timeout!==o?t.timeout:0;n.isFunction(n.getUserMedia)?(a>0&&(i=setTimeout(function(){r.onStreamingTimeout(e)},1e4)),this.startStreaming({error:r.errorCallback,streamed:function(){clearTimeout(i)},completed:function(t){var i=this.videoElement=t.videoElement,o=this.cameraStream=t.cameraStream,n=t.videoWidth,r=t.videoHeight;e(o,i,n,r)}})):e(new Error("Native device media streaming (getUserMedia) not supported in this browser."))},stopVideoStreaming:function(){var e=this.cameraStream,t=this.videoElement;e&&e.stop(),t&&(t.pause(),t.src=null,t=null)}}}(),a=function(){r.startVideoStreaming(function(e,t){t.onclick=function(){console.log(this)},i.body.appendChild(t)})}()}(window,window.navigator,document);