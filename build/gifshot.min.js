/*Copyrights for code authored by Yahoo Inc. is licensed under the following terms:
MIT License
Copyright  2014 Yahoo Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(e,t,n,i){var o,a,s,c,d,l,u,m,f,h,p,v,w,y,C,S,k,x,F,E,W,U;o=function(){var r={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=n.getUserMedia||n.webkitGetUserMedia||n.mozGetUserMedia||n.msGetUserMedia;return e?e.bind(n):e}(),Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||function(e){for(var t,r,n,i,o,a,s,c="",d=0,l=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l>d;)t=e.charCodeAt(d++),r=e.charCodeAt(d++),n=e.charCodeAt(d++),i=t>>2,o=(3&t)<<4|r>>4,a=(15&r)<<2|n>>6,s=63&n,isNaN(r)?a=s=64:isNaN(n)&&(s=64),c=c+u.charAt(i)+u.charAt(o)+u.charAt(a)+u.charAt(s);return c};return t?t.bind(e):function(){}}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return r.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=t.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},console:function(){var t=e.console;return t&&r.isFunction(t.log)},webworkers:function(){return e.Worker},blob:function(){return r.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=t.createElement("video"),r={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};return e&&e.canPlayType&&(r.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),r.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),r.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),r.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),r.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"')),r}()},log:function(){r.isSupported.console()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var n,i;if(r.isArray(e))for(n=-1,i=e.length;++n<i&&t(n,e[n])!==!1;);else if(r.isObject(e))for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break},mergeOptions:function i(e,t){if(r.isObject(e)&&r.isObject(t)&&Object.keys){var n={};return r.each(e,function(t){n[t]=e[t]}),r.each(t,function(o){var a=t[o];n[o]=r.isObject(a)&&e[o]?i(e[o],a):a}),n}},setCSSAttr:function(e,t,n){r.isElement(e)&&(r.isString(t)&&r.isString(n)?e.style[t]=n:r.isObject(t)&&r.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){r.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!r.isString(e))return{};try{var t=new r.Blob([e],{type:"text/javascript"}),n=r.URL.createObjectURL(t),i=new Worker(n);return{objectUrl:n,worker:i}}catch(o){return""+o}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(e,r,n,i){var o=t.createElement("div"),a=t.createElement("span"),s=n;for(o.setAttribute("width",r),o.appendChild(a),a.innerHTML=e,a.style.fontSize=n+"px",a.style.textIndent="-9999px",a.style.visibility="hidden",t.body.appendChild(a);a.offsetWidth>r&&s>=i;)a.style.fontSize=--s+"px";return t.body.removeChild(a),s+"px"},webWorkerError:!1};return r}(),a=function(e){var t={validate:function(r){r=e.isObject(r)?r:{};var n={};return e.each(t.validators,function(e,t){var i=t.errorCode;return r[i]||t.condition?void 0:(n=t,n.error=!0,!1)}),delete n.condition,n},isValid:function(e){var r=t.validate(e),n=r.error!==!0?!0:!1;return n},validators:[{condition:e.isFunction(e.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:e.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:e.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:e.isFunction(e.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:e.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:e.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:e.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}};return t}(o),s=function(e){return function(){return e.isValid()}}(a),c=function(e){return function(){return e.isValid()}}(a),d=function(e){return function(){return e.isValid(skippedChecks)}}(a),l=function(e,t){return function(r){var n=!1;if(e.isArray(r)&&r.length){if(e.each(r,function(t,r){e.isSupported.videoCodecs[r]&&(n=!0)}),!n)return!1}else if(e.isString(r)&&r.length&&!e.isSupported.videoCodecs[r])return!1;return t.isValid({getUserMedia:!0})}}(o,a),u={sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",fontFamily:"sans-serif",fontColor:"#FFF",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:function(){},completeCallback:function(){},saveRenderingContexts:!1,savedRenderingContexts:[]},m=function(){function e(){function e(e,t,r){var n,i;for(u=e,m=t,f=r,h=new Array(g),n=0;g>n;n++)h[n]=new Array(4),i=h[n],i[0]=i[1]=i[2]=(n<<S+8)/g|0,D[n]=F/g|0,G[n]=0}function t(){for(var e=[],t=new Array(g),r=0;g>r;r++)t[h[r][3]]=r;for(var n=0,i=0;g>i;i++){var o=t[i];e[n++]=h[o][0],e[n++]=h[o][1],e[n++]=h[o][2]}return e}function r(){var e,t,r,n,i,o,a,s;for(a=0,s=0,e=0;g>e;e++){for(i=h[e],r=e,n=i[1],t=e+1;g>t;t++)o=h[t],o[1]<n&&(r=t,n=o[1]);if(o=h[r],e!=r&&(t=o[0],o[0]=i[0],i[0]=t,t=o[1],o[1]=i[1],i[1]=t,t=o[2],o[2]=i[2],i[2]=t,t=o[3],o[3]=i[3],i[3]=t),n!=a){for(z[a]=s+e>>1,t=a+1;n>t;t++)z[t]=e;a=n,s=e}}for(z[a]=s+C>>1,t=a+1;256>t;t++)z[t]=C}function n(){var e,t,r,n,i,o,a,h,g,C,x,F,E,W;for(y>m&&(f=1),l=30+(f-1)/3,F=u,E=0,W=m,x=m/(3*f),C=x/k|0,h=j,o=R,a=o>>M,1>=a&&(a=0),e=0;a>e;e++)N[e]=h*((a*a-e*e)*P/(a*a));for(g=y>m?3:m%p!==0?3*p:m%v!==0?3*v:m%b!==0?3*b:3*w,e=0;x>e;)if(r=(255&F[E+0])<<S,n=(255&F[E+1])<<S,i=(255&F[E+2])<<S,t=d(r,n,i),c(h,t,r,n,i),0!==a&&s(a,t,r,n,i),E+=g,E>=W&&(E-=m),e++,0===C&&(C=1),e%C===0)for(h-=h/l,o-=o/V,a=o>>M,1>=a&&(a=0),t=0;a>t;t++)N[t]=h*((a*a-t*t)*P/(a*a))}function i(e,t,r){var n,i,o,a,s,c,d;for(s=1e3,d=-1,n=z[t],i=n-1;g>n||i>=0;)g>n&&(c=h[n],o=c[1]-t,o>=s?n=g:(n++,0>o&&(o=-o),a=c[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=c[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,d=c[3])))),i>=0&&(c=h[i],o=t-c[1],o>=s?i=-1:(i--,0>o&&(o=-o),a=c[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=c[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,d=c[3]))));return d}function o(){return n(),a(),r(),t()}function a(){var e;for(e=0;g>e;e++)h[e][0]>>=S,h[e][1]>>=S,h[e][2]>>=S,h[e][3]=e}function s(e,t,r,n,i){var o,a,s,c,d,l,u;for(s=t-e,-1>s&&(s=-1),c=t+e,c>g&&(c=g),o=t+1,a=t-1,l=1;c>o||a>s;){if(d=N[l++],c>o){u=h[o++];try{u[0]-=d*(u[0]-r)/B|0,u[1]-=d*(u[1]-n)/B|0,u[2]-=d*(u[2]-i)/B|0}catch(m){}}if(a>s){u=h[a--];try{u[0]-=d*(u[0]-r)/B|0,u[1]-=d*(u[1]-n)/B|0,u[2]-=d*(u[2]-i)/B|0}catch(m){}}}}function c(e,t,r,n,i){var o=h[t],a=e/j;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-n)|0,o[2]-=a*(o[2]-i)|0}function d(e,t,r){var n,i,o,a,s,c,d,l,u,m;for(l=~(1<<31),u=l,c=-1,d=c,n=0;g>n;n++)m=h[n],i=m[0]-e,0>i&&(i=-i),o=m[1]-t,0>o&&(o=-o),i+=o,o=m[2]-r,0>o&&(o=-o),i+=o,l>i&&(l=i,c=n),a=i-(G[n]>>x-S),u>a&&(u=a,d=n),s=D[n]>>W,D[n]-=s,G[n]+=s<<E;return D[c]+=U,G[c]-=A,d}var l,u,m,f,h,g=256,p=499,v=491,b=487,w=503,y=3*w,C=g-1,S=4,k=100,x=16,F=1<<x,E=10,W=10,U=F>>W,A=F<<E-W,O=g>>3,M=6,I=1<<M,R=O*I,V=30,T=10,j=1<<T,L=8,P=1<<L,H=T+L,B=1<<H,z=[],G=[],D=[],N=[];e.apply(this,arguments);var X={};return X.map=i,X.process=o,X}return e}(),f=function(e){var t=function(){try{self.onmessage=function(e){var t=e.data,r=n.run(t);t&&t.gifshot&&postMessage(r)}}catch(t){}var n={dataToRGB:function(e,t,r){for(var n=0,i=t*r*4,o=[];i>n;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){var t,r,n,i,o=[];for(t=0;t<e.length;t+=3)r=e[t],n=e[t+1],i=e[t+2],o.push(r<<16|n<<8|i);return o},processFrameWithQuantizer:function(t,n,i,o){var a,s=this.dataToRGB(t,n,i),c=new e(s,s.length,o),d=c.process(),l=new Uint32Array(this.componentizedPaletteToArray(d)),u=n*i,m=new Uint8Array(u),f=0;for(a=0;u>a;a++)r=s[f++],g=s[f++],b=s[f++],m[a]=c.map(r,g,b);return{pixels:m,palette:l}},run:function(e){var t=e.width,r=e.height,n=e.data,i=(e.palette,e.sampleInterval);return this.processFrameWithQuantizer(n,t,r,i)}};return n};return t}(m),h=function(){return function(e,t,r,n){function o(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function a(e,t,r,n){function o(r){for(;f>=r;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){h|=e<<f,f+=m,o(8)}e[t++]=r;var s=t++,c=1<<r,d=c-1,l=c+1,u=l+1,m=r+1,f=0,h=0,g=n[0]&d,p={};a(c);for(var v=1,b=n.length;b>v;++v){var w=n[v]&d,y=g<<8|w,C=p[y];if(C===i){for(h|=g<<f,f+=m;f>=8;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(c),u=l+1,m=r+1,p={}):(u>=1<<m&&++m,p[y]=u++),g=w}else g=C}return a(g),a(l),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}var s=0;n=n===i?{}:n;var c=n.loop===i?null:n.loop,d=n.palette===i?null:n.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var l=0,u=0;if(e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=(null!==d?128:0)|l,e[s++]=u,e[s++]=0,null!==c){if(0>c||c>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=0}var m=!1;this.addFrame=function(t,r,n,c,l,u){if(m===!0&&(--s,m=!1),u=u===i?{}:u,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=n||0>=c||n>65535||c>65535)throw"Width/Height invalid.";if(l.length<n*c)throw"Not enough pixels for the frame size.";var f=!0,h=u.palette;if((h===i||null===h)&&(f=!1,h=d),h===i||null===h)throw"Must supply either a local or global palette.";for(var g=o(h),p=0;g>>=1;)++p;g=1<<p;var v=u.delay===i?0:u.delay,b=u.disposal===i?0:u.disposal;if(0>b||b>3)throw"Disposal out of range.";var w=!1,y=0;if(u.transparent!==i&&null!==u.transparent&&(w=!0,y=u.transparent,0>y||y>=g))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(w===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=y,e[s++]=0),e[s++]=44,e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=f===!0?128|p-1:0,f===!0)for(var C=0,S=h.length;S>C;++C){var k=h[C];e[s++]=k>>16&255,e[s++]=k>>8&255,e[s++]=255&k}s=a(e,s,2>p?2:p,l)},this.end=function(){return m===!1&&(e[s++]=59,m=!0),s}}}(o),p=function(e,r,n,i){var o=function(t){t=e.isObject(t)?t:{},this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=e.noop,this.onRenderProgressCallback=e.noop,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=t=e.mergeOptions(this.defaultOptions,t),this.initializeWebWorkers(t)};return o.prototype={defaultOptions:{width:160,height:120,delay:250,palette:null,sampleInterval:10,numWorkers:2},workerMethods:r(),initializeWebWorkers:function(i){var o,a,s,c,d=n.toString()+r.toString()+"worker();",l=-1,u="";for(c=i.numWorkers;++l<c;)o=e.createWebWorker(d),e.isObject(o)?(a=o.objectUrl,s=o.worker,this.workers.push({worker:s,objectUrl:a}),this.availableWorkers.push(s)):(u=o,e.webWorkerError=!!o);this.workerError=u,this.canvas=t.createElement("canvas"),this.canvas.width=i.width,this.canvas.height=i.height,this.ctx=this.canvas.getContext("2d"),this.options.delay=.1*this.options.delay,this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",n=-1;++n<t;)r+=this.byteMap[e[n]];return r},onFrameFinished:function(){var e=this,t=this.frames,r=t.every(function(e){return!e.beingProcessed&&e.done});this.numRenderedFrames++,this.onRenderProgressCallback(.75*this.numRenderedFrames/t.length),r?this.generatingGIF||this.generateGIF(t,this.onRenderCompleteCallback):setTimeout(function(){e.processNextFrame()},1)},processFrame:function(e){var t,r,n=this,i=this.options,o=i.sampleInterval,a=this.frames,s=function(e){var i=e.data;delete t.data,t.pixels=Array.prototype.slice.call(i.pixels),t.palette=Array.prototype.slice.call(i.palette),t.done=!0,t.beingProcessed=!1,n.freeWorker(r),n.onFrameFinished()};return t=a[e],t.beingProcessed||t.done?void this.onFrameFinished():(t.sampleInterval=o,t.beingProcessed=!0,t.gifshot=!0,r=this.getWorker(),void(r?(r.onmessage=s,r.postMessage(t)):s({data:n.workerMethods.run(t)})))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(t,r){var n,o,a=[],s={loop:this.repeat},c=this.options,d=c.height,l=c.width,u=new i(a,l,d,s),m=this.onRenderProgressCallback,f=c.delay;this.generatingGIF=!0,e.each(t,function(e,r){var n=r.palette;m(.75+.25*r.position*1/t.length),u.addFrame(0,0,l,d,r.pixels,{palette:n,delay:f})}),u.end(),m(1),this.frames=[],this.generatingGIF=!1,e.isFunction(r)&&(n=this.bufferToString(a),o="data:image/gif;base64,"+e.btoa(n),r(o))},setRepeat:function(e){this.repeat=e},addFrame:function(t,r,n){n=e.isObject(n)?n:{};var i,o=this,a=this.ctx,s=this.options,c=s.width,d=s.height,l=(n.gifHeight,n.gifWidth,n.text),u=n.fontWeight,m=e.getFontSize(n.text,n.gifWidth,22,10),f=n.fontFamily,h=n.fontColor,g=n.textAlign,p=n.textBaseline,v=n.textXCoordinate?n.textXCoordinate:"left"===g?1:"right"===g?c:c/2,b=n.textYCoordinate?n.textYCoordinate:"top"===p?1:"center"===p?d/2:d,w=u+" "+m+" "+f;try{r&&(t.src=r),a.drawImage(t,0,0,c,d),l&&(a.font=w,a.fillStyle=h,a.textAlign=g,a.textBaseline=p,a.fillText(l,v,b)),i=a.getImageData(0,0,c,d),o.addFrameImageData(i)}catch(y){return""+y}},addFrameImageData:function(e){var t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this,r=function(r){t.destroyWorkers(),setTimeout(function(){e(r)},0)};this.startRendering(r)},destroyWorkers:function(){if(!this.workerError){var t=this.workers;e.each(t,function(t,r){var n=r.worker,i=r.objectUrl;n.terminate(),e.URL.revokeObjectURL(i)})}}},o}(o,f,m,h),v=function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})},w=function(e,r,n,i){return function(o){var a,s,c=o.images,d=o.imagesLength,l=o.callback,u=o.options,m={getUserMedia:!0,"window.URL":!0},f=i.validate(m),h=0;return f.error?l(f):(s=new r(u),void e.each(c,function(r,i){e.isElement(i)?(i.crossOrigin="Anonymous",s.addFrame(i,i.src,u),h+=1,h===d&&n(s,l)):e.isString(i)&&(a=t.createElement("img"),a.crossOrigin="Anonymous",a.onerror=function(){d>0&&(d-=1)},a.src=i,e.setCSSAttr(a,{position:"fixed",opacity:"0"}),function(t,r,i){t.onload=function(){r.addFrame(t,i,u),e.removeElement(t),h+=1,h===d&&n(r,l)}}(a,s,i),t.body.appendChild(a))}))}}(o,p,v,a),y=function(e,r){return{getWebcamGIF:function(n,o){o=e.isFunction(o)?o:function(){};var a,s=t.createElement("canvas"),c=n.videoElement,d=n.webcamVideoElement,l=n.cameraStream,u=n.gifWidth,m=n.gifHeight,f=n.videoWidth,h=n.videoHeight,g=n.sampleInterval,p=n.numWorkers,v=n.crop,b=n.interval,w=n.progressCallback,y=n.savedRenderingContexts,C=n.saveRenderingContexts,S=[],k=y.length?y.length:n.numFrames,x=k,F=new r({sampleInterval:g,numWorkers:p,width:u,height:m,delay:b}),E=n.text,W=n.fontWeight,U=e.getFontSize(n.text,n.gifWidth,22,10),A=n.fontFamily,O=n.fontColor,M=n.textAlign,I=n.textBaseline,R=n.textXCoordinate?n.textXCoordinate:"left"===M?1:"right"===M?u:u/2,V=n.textYCoordinate?n.textYCoordinate:"top"===I?1:"center"===I?m/2:m,T=W+" "+U+" "+A,j=v?Math.floor(v.scaledWidth/2):0,L=v?f-v.scaledWidth:0,P=v?Math.floor(v.scaledHeight/2):0,H=v?h-v.scaledHeight:0,B=function(){var e=x-1;y.length?a.putImageData(y[k-x],0,0):a.drawImage(c,j,P,L,H,0,0,u,m),C&&S.push(a.getImageData(0,0,u,m)),E&&(a.font=T,a.fillStyle=O,a.textAlign=M,a.textBaseline=I,a.fillText(E,R,V)),F.addFrameImageData(a.getImageData(0,0,u,m)),x=e,w((k-x)/k),e>0&&setTimeout(B,1e3*b),x||F.getBase64GIF(function(e){o({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:l,videoElement:c,webcamVideoElement:d,savedRenderingContexts:S})})};k=k!==i?k:10,b=b!==i?b:.1,s.width=u,s.height=m,a=s.getContext("2d"),B()},getCropDimensions:function(e){var t=e.videoWidth,r=e.videoHeight,n=e.gifWidth,i=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(o.width=Math.round(t*(i/r))-n,o.scaledWidth=Math.round(o.width*(r/i))):(o.height=Math.round(r*(n/t))-i,o.scaledHeight=Math.round(o.height*(t/n))),o}}}(o,p),C=function(e){return{loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function r(e){r.attempts=r.attempts||0;var t=this,n=e.videoElement,i=e.cameraStream,o=e.completedCallback;n&&(n.videoWidth>0&&n.videoHeight>0?(n.removeEventListener("loadeddata",t.findVideoSize),o({videoElement:n,cameraStream:i,videoWidth:n.videoWidth,videoHeight:n.videoHeight})):r.attempts<10?(r.attempts+=1,setTimeout(function(){t.findVideoSize(e)},200)):o({videoElement:n,cameraStream:i,videoWidth:t.defaultVideoDimensions.width,videoHeight:t.defaultVideoDimensions.height}))},onStreamingTimeout:function(t){e.isFunction(t)&&t({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(t){var r=this,n=e.isArray(t.existingVideo)?t.existingVideo[0]:t.existingVideo,i=t.videoElement,o=t.cameraStream,a=t.streamedCallback,s=t.completedCallback;e.isFunction(a)&&a(),n?e.isString(n)&&(i.src=n,i.innerHTML='<source src="'+n+'" type="video/'+e.getExtension(n)+'" />'):i.mozSrcObject?i.mozSrcObject=o:e.URL&&(i.src=e.URL.createObjectURL(o)),i.play(),setTimeout(function c(){c.count=c.count||0,r.loadedData===!0?(r.findVideoSize({videoElement:i,cameraStream:o,completedCallback:s}),r.loadedData=!1):(c.count+=1,c.count>10?r.findVideoSize({videoElement:i,cameraStream:o,completedCallback:s}):c())},100)},startStreaming:function(r){var n=this,i=e.isFunction(r.error)?r.error:e.noop,o=e.isFunction(r.streamed)?r.streamed:e.noop,a=e.isFunction(r.completed)?r.completed:e.noop,s=r.existingVideo,c=r.webcamVideoElement,d=e.isElement(s)?s:c?c:t.createElement("video"),l=r.lastCameraStream;d.crossOrigin="Anonymous",d.autoplay=!0,d.loop=!0,d.muted=!0,d.addEventListener("loadeddata",function(){n.loadedData=!0}),s?n.stream({videoElement:d,existingVideo:s,completedCallback:a}):l?n.stream({videoElement:d,cameraStream:l,streamedCallback:o,completedCallback:a}):e.getUserMedia({video:!0},function(e){n.stream({videoElement:d,cameraStream:e,streamedCallback:o,completedCallback:a})},i)},startVideoStreaming:function(e,t){t=t||{};var r,n=this,o=t.timeout!==i?t.timeout:0,a=t.callback,s=t.webcamVideoElement;o>0&&(r=setTimeout(function(){n.onStreamingTimeout(a)},1e4)),this.startStreaming({error:function(){a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(t){var r=t.cameraStream,n=t.videoElement,i=t.videoWidth,o=t.videoHeight;e({cameraStream:r,videoElement:n,videoWidth:i,videoHeight:o})},lastCameraStream:t.lastCameraStream,webcamVideoElement:s})},stopVideoStreaming:function(t){t=e.isObject(t)?t:{};var r=t.cameraStream,n=t.videoElement,i=t.keepCameraOn,o=t.webcamVideoElement;!i&&r&&e.isFunction(r.stop)&&r.stop(),e.isElement(n)&&!o&&(n.pause(),e.isFunction(e.URL.revokeObjectURL)&&!e.webWorkerError&&n.src&&e.URL.revokeObjectURL(n.src),e.removeElement(n))}}}(o),S=function(e,t){return function(r){r=e.isObject(r)?r:{};var n=e.isObject(r.options)?r.options:{},i=r.cameraStream,o=r.videoElement,a=r.webcamVideoElement;t.stopVideoStreaming({cameraStream:i,videoElement:o,keepCameraOn:n.keepCameraOn,webcamVideoElement:a})}}(o,C),k=function(e,r,n){return function(i,o){var a=i.options||{},s=(a.numFrames,a.interval),c=a.video?0:1e4*s,d=i.cameraStream,l=i.videoElement,u=i.videoWidth,m=i.videoHeight,f=a.gifWidth,h=a.gifHeight,g=r.getCropDimensions({videoWidth:u,videoHeight:m,gifHeight:h,gifWidth:f}),p=o;a.crop=g,a.videoElement=l,a.videoWidth=u,a.videoHeight=m,a.cameraStream=d,e.isElement(l)&&(l.width=f+g.width,l.height=h+g.height,a.webcamVideoElement||(e.setCSSAttr(l,{position:"fixed",opacity:"0"}),t.body.appendChild(l)),l.play(),setTimeout(function(){r.getWebcamGIF(a,function(e){n(e),p(e)})},c))}}(o,y,S),x=function(e,t,r,n){return function(i){var o,a,s=i.existingVideo,c=i.callback,d=i.options,l={getUserMedia:!0,"window.URL":!0},u=n.validate(l);if(u.error)return c(u);if(e.isElement(s)&&s.src){if(a=s.src,o=e.getExtension(a),!e.isSupported.videoCodecs[o])return c(n.messages.videoCodecs)}else e.isArray(s)&&e.each(s,function(t,r){return o=r.substr(r.lastIndexOf(".")+1,r.length),e.isSupported.videoCodecs[o]?(s=r,!1):void 0});r.startStreaming({completed:function(e){e.options=d||{},t(e,c)},existingVideo:s})}}(o,k,C,a),F=function(e,t,r,n,i,o){return function(e){var a=e.lastCameraStream,s=e.callback,c=e.webcamVideoElement,d=e.options;return o()?d.savedRenderingContexts.length?void n.getWebcamGIF(d,function(e){s(e)}):void i.startVideoStreaming(function(e){e.options=d||{},r(e,s)},{lastCameraStream:a,callback:s,webcamVideoElement:c}):s(t.validate())}}(o,a,k,y,C,c),E=function(e,t,r,n,i){return function(o,a){if(a=e.isFunction(o)?o:a,o=e.isObject(o)?o:{},e.isFunction(a)){var s=e.mergeOptions(t,o)||{},c=o.cameraStream,d=s.images,l=d?d.length:0,u=s.video,m=s.webcamVideoElement;l?r({images:d,imagesLength:l,callback:a,options:s}):u?n({existingVideo:u,callback:a,options:s}):i({lastCameraStream:c,callback:a,webcamVideoElement:m,options:s})}}}(o,u,w,x,F),W=function(e,t,r){return function(n,i){if(i=e.isFunction(n)?n:i,n=e.isObject(n)?n:{},e.isFunction(i)){var o=e.mergeOptions(t,n),a=e.mergeOptions(o,{interval:.1,numFrames:1});r(a,i)}}}(o,u,E),U=function(e,t,r,n,i,o,a,s){var c={utils:e,createGIF:o,takeSnapShot:a,stopVideoStreaming:s,isSupported:t,isWebCamGIFSupported:r,isExistingVideoGIFSupported:i,isExistingImagesGIFSupported:n};return c}(o,s,c,d,l,E,W,S),function(t){"function"==typeof define&&define.amd?define([],function(){return t}):"undefined"!=typeof exports?module.exports=t:e.gifshot=t}(U)}(this||{},"undefined"!=typeof document?document:{createElement:function(){}},this.navigator||{});