!function(e,t,i,o){var a,n,r,d;a={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isCanvasSupported:function(){var e=i.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isConsoleSupported:function(){var t=e.console;return t&&this.isFunction(t.log)},log:function(){this.isConsoleSupported()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var i,o;if(this.isArray(e))for(i=-1,o=e.length;++i<o&&t(i,e[i])!==!1;);else if(this.isObject(e))for(i in e)if(e.hasOwnProperty(i)&&t(i,e[i])===!1)break},mergeOptions:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},setCSSAttr:function(e,t,i){this.isElement(e)&&(this.isString(t)&&this.isString(i)?e.style[t]=i:this.isObject(t)&&this.each(t,function(t,i){e.style[t]=i}))}},n=function(){return{videoElement:o,cameraStream:o,defaultVideoDimensions:{height:640,width:480},findVideoSize:function e(t){var i=t.videoElement,o=t.cameraStream,a=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",this.findVideoSize),a({videoElement:i,cameraStream:o,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):a({videoElement:i,cameraStream:o,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){a.log("Timed out while trying to start streaming"),a.isFunction(e)&&e({})},errorCallback:function(e){a.log("getUserMedia cannot access the camera"),a.isFunction(e)&&e({})},stream:function(e){var t=this,i=e.videoElement,o=e.cameraStream,n=e.streamedCallback,r=e.completedCallback;n(),i.mozSrcObject?i.mozSrcObject=o:a.URL&&(i.src=a.URL.createObjectURL(o)),i.play(),setTimeout(function d(){d.count=d.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:i,cameraStream:o,completedCallback:r}),t.loadedData=!1):(d.count+=1,d.count>10?t.findVideoSize({videoElement:i,cameraStream:o,completedCallback:r}):d())},100)},startStreaming:function(e){var t=this,o=a.isFunction(e.error)?e.error:a.noop,n=a.isFunction(e.streamed)?e.streamed:a.noop,r=a.isFunction(e.completed)?e.completed:a.noop,d=i.createElement("video"),s=e.lastCameraStream;d.autoplay=!0,d.addEventListener("loadeddata",function(){t.loadedData=!0}),s?t.stream({videoElement:d,cameraStream:s,streamedCallback:n,completedCallback:r}):a.getUserMedia({video:!0},function(e){t.stream({videoElement:d,cameraStream:e,streamedCallback:n,completedCallback:r})},o)},startVideoStreaming:function(e,t){t=t||{};var i,n=this,r=t.timeout!==o?t.timeout:0;a.isFunction(a.getUserMedia)?(r>0&&(i=setTimeout(function(){n.onStreamingTimeout(e)},1e4)),this.startStreaming({error:function(){n.errorCallback(e)},streamed:function(){clearTimeout(i)},completed:function(t){var i=this.cameraStream=t.cameraStream,o=this.videoElement=t.videoElement,a=t.videoWidth,n=t.videoHeight;e({cameraStream:i,videoElement:o,videoWidth:a,videoHeight:n})},lastCameraStream:t.lastCameraStream})):(a.log("Native device media streaming (getUserMedia) not supported in this browser."),e({}))},stopVideoStreaming:function(){var e=this.cameraStream,t=this.videoElement;e&&e.stop(),t&&(t.pause(),t.src=null,t=null)}}}(),r=function(){return{getWebcamGif:function(e,t){if(t=a.isFunction(t)?t:function(){},!a.isCanvasSupported())return a.log("ERROR: Canvas not supported"),void t();var n,r=i.createElement("canvas"),d=e.videoElement,s=e.gifWidth,c=e.gifHeight,m=e.videoWidth,l=e.videoHeight,u=e.crop,h=e.interval,g=e.progressCallback,f=e.numFrames,v=f,p=new Animated_GIF({workerPath:"src/vendor/Animated_GIF.worker.js"}),S=Math.floor(u.scaledWidth/2),b=m-u.scaledWidth,C=Math.floor(u.scaledHeight/2),y=l-u.scaledHeight,E=function(){var e=v-1;e>0&&setTimeout(E,1e3*h),n.drawImage(d,S,C,b,y,0,0,s,c),p.addFrameImageData(n.getImageData(0,0,s,c)),v=e,g((f-v)/f),v||p.getBase64GIF(function(e){p.destroy(),t(e)})};f=f!==o?f:3,h=h!==o?h:.1,r.width=s,r.height=c,n=r.getContext("2d"),p.setSize(s,c),p.setDelay(h),E()},getCropDimensions:function(e){var t=e.videoWidth,i=e.videoHeight,o=e.gifWidth,a=e.gifHeight,n={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>i?(n.width=Math.round(t*(a/i))-o,n.scaledWidth=Math.round(n.width*(i/a))):(n.height=Math.round(i*(o/t))-a,n.scaledHeight=Math.round(n.height*(t/o))),console.log("result",n),n}}}(),d=function(){var t,o={defaultOptions:{gifWidth:135,gifHeight:101,interval:.2,numFrames:10,progressCallback:function(){},completeCallback:function(){}},createWebcamGif:function(e){e=a.isObject(e)?e:{};var d=o.defaultOptions,s=a.mergeOptions(d,e);n.startVideoStreaming(function(e){var o=e.cameraStream,n=e.videoElement,d=e.videoWidth,c=e.videoHeight,m=s.gifWidth,l=s.gifHeight,u=r.getCropDimensions({videoWidth:d,videoHeight:c,gifHeight:l,gifWidth:m}),h=s.completeCallback;t=o,s.crop=u,s.videoElement=n,s.videoWidth=d,s.videoHeight=c,a.isElement(n)&&(n.src=a.URL.createObjectURL(o),n.width=m+u.width,n.height=l+u.height,a.setCSSAttr(n,{position:"absolute",width:m+u.videoWidth+"px",height:l+u.videoHeight+"px",left:-Math.floor(u.videoWidth/2)+"px",top:-Math.floor(u.videoHeight/2)+"px",opacity:"0"}),i.body.appendChild(n),n.play(),r.getWebcamGif(s,h))},{lastCameraStream:t})}};"function"==typeof define&&define.amd?o=function(){return o}():"undefined"!=typeof exports?module.exports=o:e.gifshot=o}(a)}(window,window.navigator,document);