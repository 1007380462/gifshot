/*Copyrights for code authored by Yahoo! Inc. is licensed under the following terms:
MIT License
Copyright  2014 Yahoo! Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(e,t,i,o){var n,a,s,d,c,l,u,m,f;u=f=function(){var r={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||this.btoaPolyfill;return t?t.bind(e):!1}(),btoaPolyfill:function(e){for(var t,r,i,o,n,a,s,d="",c=0,l=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l>c;)t=e.charCodeAt(c++),r=e.charCodeAt(c++),i=e.charCodeAt(c++),o=t>>2,n=(3&t)<<4|r>>4,a=(15&r)<<2|i>>6,s=63&i,isNaN(r)?a=s=64:isNaN(i)&&(s=64),d=d+u.charAt(o)+u.charAt(n)+u.charAt(a)+u.charAt(s);return d},isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isEmptyObject:function(e){var t=!0;return r.isFunction(Object.keys)?t=!Object.keys(e).length:r.each(e,function(){t=!1}),t},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=i.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},console:function(){var t=e.console;return t&&r.isFunction(t.log)},webworkers:function(){return e.Worker},blob:function(){return r.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=i.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};return e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"')),t}()},log:function(){r.isSupported.console()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var i,o;if(r.isArray(e))for(i=-1,o=e.length;++i<o&&t(i,e[i])!==!1;);else if(r.isObject(e))for(i in e)if(e.hasOwnProperty(i)&&t(i,e[i])===!1)break},mergeOptions:function o(e,t){if(r.isObject(e)&&r.isObject(t)&&Object.keys){var i={};return r.each(e,function(t){i[t]=e[t]}),r.each(t,function(n){var a=t[n];i[n]=r.isObject(a)&&e[n]?o(e[n],a):a}),i}},setCSSAttr:function(e,t,i){r.isElement(e)&&(r.isString(t)&&r.isString(i)?e.style[t]=i:r.isObject(t)&&r.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){r.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!r.isString(e))return{};try{var t=new r.Blob([e],{type:"text/javascript"}),i=r.URL.createObjectURL(t),o=new Worker(i);return{objectUrl:i,worker:o}}catch(n){return""+n}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},webWorkerError:!1};return r}(),n=function(){return{loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var r=this,i=t.videoElement,o=t.cameraStream,n=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",r.findVideoSize),n({videoElement:i,cameraStream:o,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(function(){r.findVideoSize(t)},200)):n({videoElement:i,cameraStream:o,videoWidth:r.defaultVideoDimensions.width,videoHeight:r.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){f.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=this,r=f.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,i=e.videoElement,o=e.cameraStream,n=e.streamedCallback,a=e.completedCallback;f.isFunction(n)&&n(),r?f.isString(r)&&(i.src=r,i.innerHTML='<source src="'+r+'" type="video/'+f.getExtension(r)+'" />'):i.mozSrcObject?i.mozSrcObject=o:f.URL&&(i.src=f.URL.createObjectURL(o)),i.play(),setTimeout(function s(){s.count=s.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:i,cameraStream:o,completedCallback:a}),t.loadedData=!1):(s.count+=1,s.count>10?t.findVideoSize({videoElement:i,cameraStream:o,completedCallback:a}):s())},100)},startStreaming:function(e){var t=this,r=f.isFunction(e.error)?e.error:f.noop,o=f.isFunction(e.streamed)?e.streamed:f.noop,n=f.isFunction(e.completed)?e.completed:f.noop,a=e.existingVideo,s=e.webcamVideoElement,d=f.isElement(a)?a:s?s:i.createElement("video"),c=e.lastCameraStream;d.crossOrigin="Anonymous",d.autoplay=!0,d.loop=!0,d.muted=!0,d.addEventListener("loadeddata",function(){t.loadedData=!0}),a?t.stream({videoElement:d,existingVideo:a,completedCallback:n}):c?t.stream({videoElement:d,cameraStream:c,streamedCallback:o,completedCallback:n}):f.getUserMedia({video:!0},function(e){t.stream({videoElement:d,cameraStream:e,streamedCallback:o,completedCallback:n})},r)},startVideoStreaming:function(e,t){t=t||{};var r,i=this,n=t.timeout!==o?t.timeout:0,a=t.callback,s=t.webcamVideoElement;n>0&&(r=setTimeout(function(){i.onStreamingTimeout(a)},1e4)),this.startStreaming({error:function(){a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(t){var r=t.cameraStream,i=t.videoElement,o=t.videoWidth,n=t.videoHeight;e({cameraStream:r,videoElement:i,videoWidth:o,videoHeight:n})},lastCameraStream:t.lastCameraStream,webcamVideoElement:s})},stopVideoStreaming:function(e){e=f.isObject(e)?e:{};var t=e.cameraStream,r=e.videoElement,i=e.keepCameraOn,o=e.webcamVideoElement;!i&&t&&f.isFunction(t.stop)&&t.stop(),f.isElement(r)&&!o&&(r.pause(),f.isFunction(f.URL.revokeObjectURL)&&!f.webWorkerError&&r.src&&f.URL.revokeObjectURL(r.src),f.removeElement(r))}}}(),a=function(){function e(){function e(e,t,r){var i,o;for(u=e,m=t,f=r,h=new Array(g),i=0;g>i;i++)h[i]=new Array(4),o=h[i],o[0]=o[1]=o[2]=(i<<C+8)/g|0,D[i]=E/g|0,z[i]=0}function t(){for(var e=[],t=new Array(g),r=0;g>r;r++)t[h[r][3]]=r;for(var i=0,o=0;g>o;o++){var n=t[o];e[i++]=h[n][0],e[i++]=h[n][1],e[i++]=h[n][2]}return e}function r(){var e,t,r,i,o,n,a,s;for(a=0,s=0,e=0;g>e;e++){for(o=h[e],r=e,i=o[1],t=e+1;g>t;t++)n=h[t],n[1]<i&&(r=t,i=n[1]);if(n=h[r],e!=r&&(t=n[0],n[0]=o[0],o[0]=t,t=n[1],n[1]=o[1],o[1]=t,t=n[2],n[2]=o[2],o[2]=t,t=n[3],n[3]=o[3],o[3]=t),i!=a){for(H[a]=s+e>>1,t=a+1;i>t;t++)H[t]=e;a=i,s=e}}for(H[a]=s+S>>1,t=a+1;256>t;t++)H[t]=S}function i(){var e,t,r,i,o,n,a,h,g,S,F,E,W,x;for(y>m&&(f=1),l=30+(f-1)/3,E=u,W=0,x=m,F=m/(3*f),S=F/k|0,h=V,n=j,a=n>>I,1>=a&&(a=0),e=0;a>e;e++)_[e]=h*((a*a-e*e)*P/(a*a));for(g=y>m?3:m%p!==0?3*p:m%v!==0?3*v:m%b!==0?3*b:3*w,e=0;F>e;)if(r=(255&E[W+0])<<C,i=(255&E[W+1])<<C,o=(255&E[W+2])<<C,t=c(r,i,o),d(h,t,r,i,o),0!==a&&s(a,t,r,i,o),W+=g,W>=x&&(W-=m),e++,0===S&&(S=1),e%S===0)for(h-=h/l,n-=n/R,a=n>>I,1>=a&&(a=0),t=0;a>t;t++)_[t]=h*((a*a-t*t)*P/(a*a))}function o(e,t,r){var i,o,n,a,s,d,c;for(s=1e3,c=-1,i=H[t],o=i-1;g>i||o>=0;)g>i&&(d=h[i],n=d[1]-t,n>=s?i=g:(i++,0>n&&(n=-n),a=d[0]-e,0>a&&(a=-a),n+=a,s>n&&(a=d[2]-r,0>a&&(a=-a),n+=a,s>n&&(s=n,c=d[3])))),o>=0&&(d=h[o],n=t-d[1],n>=s?o=-1:(o--,0>n&&(n=-n),a=d[0]-e,0>a&&(a=-a),n+=a,s>n&&(a=d[2]-r,0>a&&(a=-a),n+=a,s>n&&(s=n,c=d[3]))));return c}function n(){return i(),a(),r(),t()}function a(){var e;for(e=0;g>e;e++)h[e][0]>>=C,h[e][1]>>=C,h[e][2]>>=C,h[e][3]=e}function s(e,t,r,i,o){var n,a,s,d,c,l,u;for(s=t-e,-1>s&&(s=-1),d=t+e,d>g&&(d=g),n=t+1,a=t-1,l=1;d>n||a>s;){if(c=_[l++],d>n){u=h[n++];try{u[0]-=c*(u[0]-r)/L|0,u[1]-=c*(u[1]-i)/L|0,u[2]-=c*(u[2]-o)/L|0}catch(m){}}if(a>s){u=h[a--];try{u[0]-=c*(u[0]-r)/L|0,u[1]-=c*(u[1]-i)/L|0,u[2]-=c*(u[2]-o)/L|0}catch(m){}}}}function d(e,t,r,i,o){var n=h[t],a=e/V;n[0]-=a*(n[0]-r)|0,n[1]-=a*(n[1]-i)|0,n[2]-=a*(n[2]-o)|0}function c(e,t,r){var i,o,n,a,s,d,c,l,u,m;for(l=~(1<<31),u=l,d=-1,c=d,i=0;g>i;i++)m=h[i],o=m[0]-e,0>o&&(o=-o),n=m[1]-t,0>n&&(n=-n),o+=n,n=m[2]-r,0>n&&(n=-n),o+=n,l>o&&(l=o,d=i),a=o-(z[i]>>F-C),u>a&&(u=a,c=i),s=D[i]>>x,D[i]-=s,z[i]+=s<<W;return D[d]+=A,z[d]-=U,c}var l,u,m,f,h,g=256,p=499,v=491,b=487,w=503,y=3*w,S=g-1,C=4,k=100,F=16,E=1<<F,W=10,x=10,A=E>>x,U=E<<W-x,O=g>>3,I=6,M=1<<I,j=O*M,R=30,T=10,V=1<<T,G=8,P=1<<G,B=T+G,L=1<<B,H=[],z=[],D=[],_=[];e.apply(this,arguments);var N={};return N.map=o,N.process=n,N}return e}(),s=function(){var e=function(){self.onmessage=function(t){var r=t.data,i=e.run(r);postMessage(i)};var e={dataToRGB:function(e,t,r){for(var i=0,o=t*r*4,n=[];o>i;)n.push(e[i++]),n.push(e[i++]),n.push(e[i++]),i++;return n},componentizedPaletteToArray:function(e){var t,r,i,o,n=[];for(t=0;t<e.length;t+=3)r=e[t],i=e[t+1],o=e[t+2],n.push(r<<16|i<<8|o);return n},processFrameWithQuantizer:function(e,t,i,o){var n,s=this.dataToRGB(e,t,i),d=new a(s,s.length,o),c=d.process(),l=new Uint32Array(this.componentizedPaletteToArray(c)),u=t*i,m=new Uint8Array(u),f=0;for(n=0;u>n;n++)r=s[f++],g=s[f++],b=s[f++],m[n]=d.map(r,g,b);return{pixels:m,palette:l}},run:function(e){var t=e.width,r=e.height,i=e.data,o=(e.palette,e.sampleInterval);return this.processFrameWithQuantizer(i,t,r,o)}};return e};return e}(),d=function(){function e(e,t,r,i){function n(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function a(e,t,r,i){function n(r){for(;f>=r;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){h|=e<<f,f+=m,n(8)}e[t++]=r;var s=t++,d=1<<r,c=d-1,l=d+1,u=l+1,m=r+1,f=0,h=0,g=i[0]&c,p={};a(d);for(var v=1,b=i.length;b>v;++v){var w=i[v]&c,y=g<<8|w,S=p[y];if(S===o){for(h|=g<<f,f+=m;f>=8;)e[t++]=255&h,h>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(d),u=l+1,m=r+1,p={}):(u>=1<<m&&++m,p[y]=u++),g=w}else g=S}return a(g),a(l),n(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}var s=0;i=i===o?{}:i;var d=i.loop===o?null:i.loop,c=i.palette===o?null:i.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var l=0,u=0;if(e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=(null!==c?128:0)|l,e[s++]=u,e[s++]=0,null!==d){if(0>d||d>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&d,e[s++]=d>>8&255,e[s++]=0}var m=!1;this.addFrame=function(t,r,i,d,l,u){if(m===!0&&(--s,m=!1),u=u===o?{}:u,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=i||0>=d||i>65535||d>65535)throw"Width/Height invalid.";if(l.length<i*d)throw"Not enough pixels for the frame size.";var f=!0,h=u.palette;if((h===o||null===h)&&(f=!1,h=c),h===o||null===h)throw"Must supply either a local or global palette.";for(var g=n(h),p=0;g>>=1;)++p;g=1<<p;var v=u.delay===o?0:u.delay,b=u.disposal===o?0:u.disposal;if(0>b||b>3)throw"Disposal out of range.";var w=!1,y=0;if(u.transparent!==o&&null!==u.transparent&&(w=!0,y=u.transparent,0>y||y>=g))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(w===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=y,e[s++]=0),e[s++]=44,e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&i,e[s++]=i>>8&255,e[s++]=255&d,e[s++]=d>>8&255,e[s++]=f===!0?128|p-1:0,f===!0)for(var S=0,C=h.length;C>S;++S){var k=h[S];e[s++]=k>>16&255,e[s++]=k>>8&255,e[s++]=255&k}s=a(e,s,2>p?2:p,l)},this.end=function(){return m===!1&&(e[s++]=59,m=!0),s}}return e}(),c=function(e){var t=function(e){e=f.isObject(e)?e:{},this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=f.noop,this.onRenderProgressCallback=f.noop,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e=f.mergeOptions(this.defaultOptions,e),this.initializeWebWorkers(e)};return t.prototype={defaultOptions:{width:160,height:120,delay:250,palette:null,sampleInterval:10,numWorkers:2},workerMethods:e(),initializeWebWorkers:function(t){var r,o,n,s,d=a.toString()+e.toString()+"worker();",c=-1,l="";for(s=t.numWorkers;++c<s;)r=f.createWebWorker(d),f.isObject(r)?(o=r.objectUrl,n=r.worker,this.workers.push({worker:n,objectUrl:o}),this.availableWorkers.push(n)):(l=r,f.webWorkerError=!!r);this.workerError=l,this.canvas=i.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx=this.canvas.getContext("2d"),this.options.delay=.1*this.options.delay,this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(){var e=this,t=this.frames,r=t.every(function(e){return!e.beingProcessed&&e.done});this.numRenderedFrames++,this.onRenderProgressCallback(.75*this.numRenderedFrames/t.length),r?this.generatingGIF||this.generateGIF(t,this.onRenderCompleteCallback):setTimeout(function(){e.processNextFrame()},1)},processFrame:function(e){var t,r,i=this,o=this.options,n=o.sampleInterval,a=this.frames,s=function(e){var o=e.data;delete t.data,t.pixels=Array.prototype.slice.call(o.pixels),t.palette=Array.prototype.slice.call(o.palette),t.done=!0,t.beingProcessed=!1,i.freeWorker(r),i.onFrameFinished()};return t=a[e],t.beingProcessed||t.done?void this.onFrameFinished():(t.sampleInterval=n,t.beingProcessed=!0,r=this.getWorker(),void(r?(r.onmessage=s,r.postMessage(t)):s({data:i.workerMethods.run(t)})))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var r,i,o=[],n={loop:this.repeat},a=this.options,s=a.height,c=a.width,l=new d(o,c,s,n),u=this.onRenderProgressCallback,m=a.delay;this.generatingGIF=!0,f.each(e,function(t,r){var i=r.palette;u(.75+.25*r.position*1/e.length),l.addFrame(0,0,c,s,r.pixels,{palette:i,delay:m})}),l.end(),u(1),this.frames=[],this.generatingGIF=!1,f.isFunction(t)&&(r=this.bufferToString(o),i="data:image/gif;base64,"+f.btoa(r),t(i))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t,r){r=f.isObject(r)?r:{};var i,o=this,n=this.ctx,a=this.options,s=a.width,d=a.height,c=(r.gifHeight,r.gifWidth,r.text),l=r.fontWeight,u=r.fontSize,m=r.fontFamily,h=r.fontColor,g=r.textAlign,p=r.textBaseline,v=r.textXCoordinate?r.textXCoordinate:"left"===g?1:"right"===g?s:s/2,b=r.textYCoordinate?r.textYCoordinate:"top"===p?1:"center"===p?d/2:d,w=l+" "+u+" "+m;try{t&&(e.src=t),n.drawImage(e,0,0,s,d),c&&(n.font=w,n.fillStyle=h,n.textAlign=g,n.textBaseline=p,n.fillText(c,v,b)),i=n.getImageData(0,0,s,d),o.addFrameImageData(i)}catch(y){return""+y}},addFrameImageData:function(e){var t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this,r=function(r){t.destroyWorkers(),setTimeout(function(){e(r)},0)};this.startRendering(r)},destroyWorkers:function(){if(!this.workerError){var e=this.workers;f.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),f.URL.revokeObjectURL(i)})}}},t}(s),l=function(e){return{getWebcamGif:function(t,r){r=f.isFunction(r)?r:function(){};var n,a=i.createElement("canvas"),s=t.videoElement,d=t.webcamVideoElement,c=t.cameraStream,l=t.gifWidth,u=t.gifHeight,m=t.videoWidth,h=t.videoHeight,g=t.sampleInterval,p=t.numWorkers,v=t.crop,b=t.interval,w=t.progressCallback,y=t.numFrames,S=y,C=new e({sampleInterval:g,numWorkers:p,width:l,height:u,delay:b}),k=t.text,F=t.fontWeight,E=t.fontSize,W=t.fontFamily,x=t.fontColor,A=t.textAlign,U=t.textBaseline,O=t.textXCoordinate?t.textXCoordinate:"left"===A?1:"right"===A?l:l/2,I=t.textYCoordinate?t.textYCoordinate:"top"===U?1:"center"===U?u/2:u,M=F+" "+E+" "+W,j=Math.floor(v.scaledWidth/2),R=m-v.scaledWidth,T=Math.floor(v.scaledHeight/2),V=h-v.scaledHeight,G=function(){var e=S-1;n.drawImage(s,j,T,R,V,0,0,l,u),k&&(n.font=M,n.fillStyle=x,n.textAlign=A,n.textBaseline=U,n.fillText(k,O,I)),C.addFrameImageData(n.getImageData(0,0,l,u)),S=e,w((y-S)/y),e>0&&setTimeout(G,1e3*b),S||C.getBase64GIF(function(e){r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:c,videoElement:s,webcamVideoElement:d})})};y=y!==o?y:10,b=b!==o?b:.1,a.width=l,a.height=u,n=a.getContext("2d"),G()},getCropDimensions:function(e){var t=e.videoWidth,r=e.videoHeight,i=e.gifWidth,o=e.gifHeight,n={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(n.width=Math.round(t*(o/r))-i,n.scaledWidth=Math.round(n.width*(r/o))):(n.height=Math.round(r*(i/t))-o,n.scaledHeight=Math.round(n.height*(t/i))),n}}}(c),m=function(){var e={validate:function(t){t=f.isObject(t)?t:{};var r={};return f.each(e.validators,function(e,i){var o=i.errorCode;return t[o]||i.condition?void 0:(r=i,r.error=!0,!1)}),delete r.condition,r},isValid:function(t){var r=e.validate(t),i=r.error!==!0?!0:!1;return i},validators:[{condition:f.isFunction(f.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:f.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:f.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:f.isFunction(f.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:f.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:f.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:f.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}};return e}(),function(t,r,o){var a={utils:t,_defaultOptions:{sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,text:"",fontWeight:"normal",fontSize:"16px",fontFamily:"sans-serif",fontColor:"#FFF",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:function(){},completeCallback:function(){}},_options:{},createGIF:function(e,s){if(s=t.isFunction(e)?e:s,e=t.isObject(e)?e:{},t.isFunction(s)){var d,c,l,u,m,f,h=a._defaultOptions,g=a._options=t.mergeOptions(h,e),p=e.cameraStream,v=g.images,b=g.video,w=g.webcamVideoElement,y=v?v.length:0,S={},C=-1,k=0;if(y){if(S={getUserMedia:!0,"window.URL":!0},d=o.validate(S),d.error)return s(d);for(c=new r(g);++C<y;)l=v[C],t.isElement(l)?(l.crossOrigin="Anonymous",c.addFrame(l,l.src,g),k+=1,k===y&&a._getBase64GIF(c,s)):t.isString(l)&&(u=i.createElement("img"),u.crossOrigin="Anonymous",u.onerror=function(){y>0&&(y-=1)},u.src=l,t.setCSSAttr(u,{position:"fixed",opacity:"0"}),function(e,r,i){e.onload=function(){r.addFrame(e,i,g),t.removeElement(e),k+=1,k===y&&a._getBase64GIF(r,s)}}(u,c,l),i.body.appendChild(u))}else if(b){if(S={getUserMedia:!0,"window.URL":!0},d=o.validate(S),d.error)return s(d);if(t.isElement(b)&&b.src){if(f=b.src,m=t.getExtension(f),!t.isSupported.videoCodecs[m])return s(o.messages.videoCodecs)}else t.isArray(b)&&t.each(b,function(e,r){return m=r.substr(r.lastIndexOf(".")+1,r.length),t.isSupported.videoCodecs[m]?(b=r,!1):void 0});n.startStreaming({completed:function(e){a._createAndGetGIF(e,s)},existingVideo:b})}else{if(!a.isWebCamGIFSupported())return s(o.validate());n.startVideoStreaming(function(e){a._createAndGetGIF(e,s)},{lastCameraStream:p,callback:s,webcamVideoElement:w})}}},_getBase64GIF:function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})},takeSnapShot:function(e,r){var i=t.mergeOptions(a._defaultOptions,e),o=t.mergeOptions(i,{interval:.1,numFrames:1});this.createGIF(o,r)},stopVideoStreaming:function(e){e=t.isObject(e)?e:{};var r=t.isObject(a._options)?a._options:{},i=e.cameraStream,o=e.videoElement,s=e.webcamVideoElement;n.stopVideoStreaming({cameraStream:i,videoElement:o,keepCameraOn:r.keepCameraOn,webcamVideoElement:s})},isWebCamGIFSupported:function(){return o.isValid()},isExistingVideoGIFSupported:function(e){var r=!1;if(t.isArray(e)&&e.length){if(t.each(e,function(e,i){t.isSupported.videoCodecs[i]&&(r=!0)}),!r)return!1}else if(t.isString(e)&&e.length&&!t.isSupported.videoCodecs[e])return!1;return o.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return o.isValid({getUserMedia:!0})},_createAndGetGIF:function(e,r){var o=a._options,n=(o.numFrames,o.interval),s=o.video?0:1e4*n,d=e.cameraStream,c=e.videoElement,u=e.videoWidth,m=e.videoHeight,f=o.gifWidth,h=o.gifHeight,g=l.getCropDimensions({videoWidth:u,videoHeight:m,gifHeight:h,gifWidth:f}),p=r;o.crop=g,o.videoElement=c,o.videoWidth=u,o.videoHeight=m,o.cameraStream=d,t.isElement(c)&&(c.width=f+g.width,c.height=h+g.height,o.webcamVideoElement||(t.setCSSAttr(c,{position:"fixed",opacity:"0"}),i.body.appendChild(c)),c.play(),setTimeout(function(){l.getWebcamGif(o,function(e){a.stopVideoStreaming(e),p(e)})},s))}},s=function(e){var t,r,i={};for(t in e)r=e[t],"_"!==t.charAt(0)&&(i[t]=e[t]);return i};"function"==typeof define&&define.amd?define([],function(){return s(a)}):"undefined"!=typeof exports?module.exports=s(a):e.gifshot=s(a)}(u,c,m)}(window,window.navigator,document);