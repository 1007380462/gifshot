!function(e,t,i,n){var o,a,s,c,d,u,l,f,h,m;o=function(){var r={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder,isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=i.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},console:function(){var t=e.console;return t&&r.isFunction(t.log)},webworkers:function(){return e.Worker},blob:function(){return r.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array}},log:function(){r.isSupported.console()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var i,n;if(r.isArray(e))for(i=-1,n=e.length;++i<n&&t(i,e[i])!==!1;);else if(r.isObject(e))for(i in e)if(e.hasOwnProperty(i)&&t(i,e[i])===!1)break},mergeOptions:function n(e,t){if(r.isObject(e)&&r.isObject(t)&&Object.keys){var i={};return r.each(e,function(t){i[t]=e[t]}),r.each(t,function(o){var a=t[o];i[o]=r.isObject(a)&&e[o]?n(e[o],a):a}),i}},setCSSAttr:function(e,t,i){r.isElement(e)&&(r.isString(t)&&r.isString(i)?e.style[t]=i:r.isObject(t)&&r.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){r.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(t){if(!r.isString(t))return{};try{var i=new r.Blob([t],{type:"text/javascript"}),n=e.URL.createObjectURL(i),o=new Worker(n);return{objectUrl:n,worker:o}}catch(a){return{}}}};return r}(),a=function(){return{loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var r=this,i=t.videoElement,n=t.cameraStream,o=t.completedCallback;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",r.findVideoSize),o({videoElement:i,cameraStream:n,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(function(){r.findVideoSize(t)},200)):o({videoElement:i,cameraStream:n,videoWidth:r.defaultVideoDimensions.width,videoHeight:r.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){o.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=this,r=e.videoElement,i=e.cameraStream,n=e.streamedCallback,a=e.completedCallback;n(),r.mozSrcObject?r.mozSrcObject=i:o.URL&&(r.src=o.URL.createObjectURL(i)),r.play(),setTimeout(function s(){s.count=s.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:r,cameraStream:i,completedCallback:a}),t.loadedData=!1):(s.count+=1,s.count>10?t.findVideoSize({videoElement:r,cameraStream:i,completedCallback:a}):s())},100)},startStreaming:function(e){var t=this,r=o.isFunction(e.error)?e.error:o.noop,n=o.isFunction(e.streamed)?e.streamed:o.noop,a=o.isFunction(e.completed)?e.completed:o.noop,s=i.createElement("video"),c=e.lastCameraStream;s.autoplay=!0,s.addEventListener("loadeddata",function(){t.loadedData=!0}),c?t.stream({videoElement:s,cameraStream:c,streamedCallback:n,completedCallback:a}):o.getUserMedia({video:!0},function(e){t.stream({videoElement:s,cameraStream:e,streamedCallback:n,completedCallback:a})},r)},startVideoStreaming:function(e,t){t=t||{};var r,i=this,o=t.timeout!==n?t.timeout:0,a=t.callback;o>0&&(r=setTimeout(function(){i.onStreamingTimeout(a)},1e4)),this.startStreaming({error:function(){a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(t){var r=t.cameraStream,i=t.videoElement,n=t.videoWidth,o=t.videoHeight;e({cameraStream:r,videoElement:i,videoWidth:n,videoHeight:o})},lastCameraStream:t.lastCameraStream})},stopVideoStreaming:function(e){e=o.isObject(e)?e:{};var t=e.cameraStream,r=e.videoElement,i=e.keepCameraOn;!i&&t&&o.isFunction(t.stop)&&t.stop(),o.isElement(r)&&(r.pause(),o.isFunction(o.URL.revokeObjectURL)&&o.URL.revokeObjectURL(r.src),o.removeElement(r))}}}(),s=function(){function e(){function e(e,t,r){var i,n;for(l=e,f=t,h=r,m=new Array(g),i=0;g>i;i++)m[i]=new Array(4),n=m[i],n[0]=n[1]=n[2]=(i<<k+8)/g|0,D[i]=W/g|0,V[i]=0}function t(){for(var e=[],t=new Array(g),r=0;g>r;r++)t[m[r][3]]=r;for(var i=0,n=0;g>n;n++){var o=t[n];e[i++]=m[o][0],e[i++]=m[o][1],e[i++]=m[o][2]}return e}function r(){var e,t,r,i,n,o,a,s;for(a=0,s=0,e=0;g>e;e++){for(n=m[e],r=e,i=n[1],t=e+1;g>t;t++)o=m[t],o[1]<i&&(r=t,i=o[1]);if(o=m[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(z[a]=s+e>>1,t=a+1;i>t;t++)z[t]=e;a=i,s=e}}for(z[a]=s+S>>1,t=a+1;256>t;t++)z[t]=S}function i(){var e,t,r,i,n,o,a,m,g,S,F,W,U,A;for(y>f&&(h=1),u=30+(h-1)/3,W=l,U=0,A=f,F=f/(3*h),S=F/C|0,m=L,o=E,a=o>>j,1>=a&&(a=0),e=0;a>e;e++)_[e]=m*((a*a-e*e)*x/(a*a));for(g=y>f?3:f%p!==0?3*p:f%v!==0?3*v:f%b!==0?3*b:3*w,e=0;F>e;)if(r=(255&W[U+0])<<k,i=(255&W[U+1])<<k,n=(255&W[U+2])<<k,t=d(r,i,n),c(m,t,r,i,n),0!==a&&s(a,t,r,i,n),U+=g,U>=A&&(U-=f),e++,0===S&&(S=1),e%S===0)for(m-=m/u,o-=o/G,a=o>>j,1>=a&&(a=0),t=0;a>t;t++)_[t]=m*((a*a-t*t)*x/(a*a))}function n(e,t,r){var i,n,o,a,s,c,d;for(s=1e3,d=-1,i=z[t],n=i-1;g>i||n>=0;)g>i&&(c=m[i],o=c[1]-t,o>=s?i=g:(i++,0>o&&(o=-o),a=c[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=c[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,d=c[3])))),n>=0&&(c=m[n],o=t-c[1],o>=s?n=-1:(n--,0>o&&(o=-o),a=c[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=c[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,d=c[3]))));return d}function o(){return i(),a(),r(),t()}function a(){var e;for(e=0;g>e;e++)m[e][0]>>=k,m[e][1]>>=k,m[e][2]>>=k,m[e][3]=e}function s(e,t,r,i,n){var o,a,s,c,d,u,l;for(s=t-e,-1>s&&(s=-1),c=t+e,c>g&&(c=g),o=t+1,a=t-1,u=1;c>o||a>s;){if(d=_[u++],c>o){l=m[o++];try{l[0]-=d*(l[0]-r)/B|0,l[1]-=d*(l[1]-i)/B|0,l[2]-=d*(l[2]-n)/B|0}catch(f){}}if(a>s){l=m[a--];try{l[0]-=d*(l[0]-r)/B|0,l[1]-=d*(l[1]-i)/B|0,l[2]-=d*(l[2]-n)/B|0}catch(f){}}}}function c(e,t,r,i,n){var o=m[t],a=e/L;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-i)|0,o[2]-=a*(o[2]-n)|0}function d(e,t,r){var i,n,o,a,s,c,d,u,l,f;for(u=~(1<<31),l=u,c=-1,d=c,i=0;g>i;i++)f=m[i],n=f[0]-e,0>n&&(n=-n),o=f[1]-t,0>o&&(o=-o),n+=o,o=f[2]-r,0>o&&(o=-o),n+=o,u>n&&(u=n,c=i),a=n-(V[i]>>F-k),l>a&&(l=a,d=i),s=D[i]>>A,D[i]-=s,V[i]+=s<<U;return D[c]+=O,V[c]-=M,d}var u,l,f,h,m,g=256,p=499,v=491,b=487,w=503,y=3*w,S=g-1,k=4,C=100,F=16,W=1<<F,U=10,A=10,O=W>>A,M=W<<U-A,R=g>>3,j=6,I=1<<j,E=R*I,G=30,T=10,L=1<<T,H=8,x=1<<H,P=T+H,B=1<<P,z=[],V=[],D=[],_=[];e.apply(this,arguments);var N={};return N.map=n,N.process=o,N}return e}(),c=function(){var e=function(){self.onmessage=function(t){var r=t.data,i=e.run(r);postMessage(i)};var e={dataToRGB:function(e,t,r){for(var i=0,n=t*r*4,o=[];n>i;)o.push(e[i++]),o.push(e[i++]),o.push(e[i++]),i++;return o},componentizedPaletteToArray:function(e){var t,r,i,n,o=[];for(t=0;t<e.length;t+=3)r=e[t],i=e[t+1],n=e[t+2],o.push(r<<16|i<<8|n);return o},processFrameWithQuantizer:function(t,i,n,o){var a,c=e.dataToRGB(t,i,n),d=new s(c,c.length,o),u=d.process(),l=new Uint32Array(e.componentizedPaletteToArray(u)),f=i*n,h=new Uint8Array(f),m=0;for(a=0;f>a;a++)r=c[m++],g=c[m++],b=c[m++],h[a]=d.map(r,g,b);return{pixels:h,palette:l}},run:function(t){var r=t.width,i=t.height,n=t.data,o=(t.palette,t.sampleInterval);return e.processFrameWithQuantizer(n,r,i,o)}}};return e}(),d=function(){var e=function(){self.onmessage=function(t){e.encodeGif(t.data)};var e={encodeGif:function(t){for(var r,i,n,o,a=t.frames,s=a.length,c=t.buffer,d=t.width,u=t.width,l=t.gifOptions,f=t.delay,h=(t.onRenderProgressCallback,new GifWriter(c,d,u,l)),m=-1;++m<s;)r=a[m],i=r.palette,postMessage({complete:!1,frame:r}),h.addFrame(0,0,d,u,r.pixels,{palette:i,delay:f});h.end(),n=e.bufferToString(c),o="data:image/gif;base64,"+e.btoa(n),postMessage({complete:!0,gif:o})},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},btoa:function(e){for(var t,r,i,n,o,a,s,c="",d=0,u=e.length,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u>d;)t=e.charCodeAt(d++),r=e.charCodeAt(d++),i=e.charCodeAt(d++),n=t>>2,o=(3&t)<<4|r>>4,a=(15&r)<<2|i>>6,s=63&i,isNaN(r)?a=s=64:isNaN(i)&&(s=64),c=c+l.charAt(n)+l.charAt(o)+l.charAt(a)+l.charAt(s);return c}}};return e}(),u=function(){function e(e,t,r,i){function o(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function a(e,t,r,i){function o(r){for(;h>=r;)e[t++]=255&m,m>>=8,h-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){m|=e<<h,h+=f,o(8)}e[t++]=r;var s=t++,c=1<<r,d=c-1,u=c+1,l=u+1,f=r+1,h=0,m=0,g=i[0]&d,p={};a(c);for(var v=1,b=i.length;b>v;++v){var w=i[v]&d,y=g<<8|w,S=p[y];if(S===n){for(m|=g<<h,h+=f;h>=8;)e[t++]=255&m,m>>=8,h-=8,t===s+256&&(e[s]=255,s=t++);4096===l?(a(c),l=u+1,f=r+1,p={}):(l>=1<<f&&++f,p[y]=l++),g=w}else g=S}return a(g),a(u),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}var s=0;i=i===n?{}:i;var c=i.loop===n?null:i.loop,d=i.palette===n?null:i.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var u=0,l=0;if(e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=(null!==d?128:0)|u,e[s++]=l,e[s++]=0,null!==c){if(0>c||c>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=0}var f=!1;this.addFrame=function(t,r,i,c,u,l){if(f===!0&&(--s,f=!1),l=l===n?{}:l,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=i||0>=c||i>65535||c>65535)throw"Width/Height invalid.";if(u.length<i*c)throw"Not enough pixels for the frame size.";var h=!0,m=l.palette;if((m===n||null===m)&&(h=!1,m=d),m===n||null===m)throw"Must supply either a local or global palette.";for(var g=o(m),p=0;g>>=1;)++p;g=1<<p;var v=l.delay===n?0:l.delay,b=l.disposal===n?0:l.disposal;if(0>b||b>3)throw"Disposal out of range.";var w=!1,y=0;if(l.transparent!==n&&null!==l.transparent&&(w=!0,y=l.transparent,0>y||y>=g))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(w===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=y,e[s++]=0),e[s++]=44,e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&i,e[s++]=i>>8&255,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=h===!0?128|p-1:0,h===!0)for(var S=0,k=m.length;k>S;++S){var C=m[S];e[s++]=C>>16&255,e[s++]=C>>8&255,e[s++]=255&C}s=a(e,s,2>p?2:p,u)},this.end=function(){return f===!1&&(e[s++]=59,f=!0),s}}return e}(),l=function(e,t){var r=function(e){e=o.isObject(e)?e:{},this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=o.noop,this.onRenderProgressCallback=o.noop,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e=o.mergeOptions(this.defaultOptions,e),this.initializeWebWorkers(e)};return r.prototype={defaultOptions:{width:160,height:120,delay:250,palette:null,sampleInterval:10,numWorkers:2},initializeWebWorkers:function(t){var r,n,a,c,d=s.toString()+e.toString()+"worker();",u=-1;for(c=t.numWorkers;++u<c;)r=o.createWebWorker(d),n=r.objectUrl,a=r.worker,this.workers.push({worker:a,objectUrl:n}),this.availableWorkers.push(a);this.canvas=i.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx=this.canvas.getContext("2d"),this.options.delay=.1*this.options.delay,this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(){var e=this,t=this.frames,r=t.every(function(e){return!e.beingProcessed&&e.done});this.numRenderedFrames++,this.onRenderProgressCallback(.75*this.numRenderedFrames/t.length),r?this.generatingGIF||this.generateGIF(t,this.onRenderCompleteCallback):setTimeout(function(){e.processNextFrame()},1)},processFrame:function(e){var t,r,i=this,n=this.options,o=n.sampleInterval,a=this.frames;return t=a[e],t.beingProcessed||t.done?void this.onFrameFinished():(t.sampleInterval=o,t.beingProcessed=!0,r=this.getWorker(),r.onmessage=function(e){var n=e.data;delete t.data,t.pixels=Array.prototype.slice.call(n.pixels),t.palette=Array.prototype.slice.call(n.palette),t.done=!0,t.beingProcessed=!1,i.freeWorker(r),i.onFrameFinished()},void r.postMessage(t))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,r){var i=this,n=this.options,a=[],s={loop:this.repeat},c=n.height,u=n.width,l=this.onRenderProgressCallback,f=n.delay,h=t.toString()+d.toString()+"worker();",m=o.createWebWorker(h),g=m.worker,p=m.objectUrl;this.generatingGIF=!0,g.onmessage=function(t){var n=t.data,a=n.gif,s=n.frame,c=n.complete;return c===!1?void l(.75+.25*s.position*1/e.length):(l(1),i.frames=[],i.generatingGIF=!1,o.URL.revokeObjectURL(p),g.terminate(),o.isFunction(r)&&r(a),void 0)},g.postMessage({frames:e,buffer:a,width:u,height:c,gifOptions:s,delay:f})},setRepeat:function(e){this.repeat=e},addFrame:function(e){var t,r=this.ctx,i=this.options,n=i.width,o=i.height;r.drawImage(e,0,0,n,o),t=r.getImageData(0,0,n,o),this.addFrameImageData(t)},addFrameImageData:function(e){var t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this,r=function(r){t.destroyWorkers(),setTimeout(function(){e(r)},0)};this.startRendering(r)},destroyWorkers:function(){var e=this.workers;o.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),o.URL.revokeObjectURL(i)})}},r}(c,u),f=function(e){return{getWebcamGif:function(t,r){r=o.isFunction(r)?r:function(){};var a,s=i.createElement("canvas"),c=t.videoElement,d=t.cameraStream,u=t.gifWidth,l=t.gifHeight,f=t.videoWidth,h=t.videoHeight,m=t.sampleInterval,g=t.numWorkers,p=t.crop,v=t.interval,b=t.progressCallback,w=t.numFrames,y=w,S=new e({sampleInterval:m,numWorkers:g,width:u,height:l,delay:v}),k=Math.floor(p.scaledWidth/2),C=f-p.scaledWidth,F=Math.floor(p.scaledHeight/2),W=h-p.scaledHeight,U=function(){var e=y-1;a.drawImage(c,k,F,C,W,0,0,u,l),S.addFrameImageData(a.getImageData(0,0,u,l)),y=e,b((w-y)/w),e>0&&setTimeout(U,1e3*v),y||S.getBase64GIF(function(e){r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:d,videoElement:c})})};w=w!==n?w:10,v=v!==n?v:.1,s.width=u,s.height=l,a=s.getContext("2d"),U()},getCropDimensions:function(e){var t=e.videoWidth,r=e.videoHeight,i=e.gifWidth,n=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(o.width=Math.round(t*(n/r))-i,o.scaledWidth=Math.round(o.width*(r/n))):(o.height=Math.round(r*(i/t))-n,o.scaledHeight=Math.round(o.height*(t/i))),o}}}(l),h=function(){var e={validate:function(t){t=o.isObject(t)?t:{};var r={};return o.each(e.validators,function(e,i){var n=i.errorCode;return t[n]||i.condition?void 0:(r=i,r.error=!0,!1)}),delete r.condition,r},isValid:function(t){var r=e.validate(t),i=r.error!==!0?!0:!1;return i},validators:[{condition:o.isFunction(o.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:o.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:o.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:o.isFunction(o.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:o.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:o.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:o.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}]};return e}(),m=function(t){var r={_defaultOptions:{sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,images:[],video:null,progressCallback:function(){},completeCallback:function(){}},_options:{},AnimatedGif:t,createGIF:function(e,n){if(n=o.isFunction(e)?e:n,e=o.isObject(e)?e:{},o.isFunction(n)){var s,c=r._defaultOptions,d=r._options=o.mergeOptions(c,e),u=e.cameraStream,l=d.images,f=l?l.length:0;if(f){if(s=h.validate({getUserMedia:!0,"window.URL":!0}),console.log("errorObj",s),s.error)return n(s);for(var m,g,p=new t(d),v=-1,b=0;++v<f;)m=l[v],o.isElement(m)?(m.crossOrigin="Anonymous",p.addFrame(m),b+=1,b===f&&r._getBase64GIF(p,n)):o.isString(m)&&(g=i.createElement("img"),g.crossOrigin="Anonymous",g.src=m,o.setCSSAttr(g,{position:"fixed",opacity:"0"}),function(e,t){e.onload=function(){t.addFrame(e),o.removeElement(e),b+=1,b===f&&r._getBase64GIF(t,n)}}(g,p),i.body.appendChild(g))}else{if(!r.isSupported())return n(h.validate());a.startVideoStreaming(function(e){r._createAndGetGIF(e,n)},{lastCameraStream:u,callback:n})}}},_getBase64GIF:function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})},takeSnapShot:function(e,t){var i=o.mergeOptions(r._defaultOptions,e),n=o.mergeOptions(i,{interval:.1,numFrames:1});this.createGIF(n,t)},stopVideoStreaming:function(e){e=o.isObject(e)?e:{};var t=o.isObject(r._options)?r._options:{},i=e.cameraStream,n=e.videoElement;a.stopVideoStreaming({cameraStream:i,videoElement:n,keepCameraOn:t.keepCameraOn})},isSupported:function(e){return h.isValid(e)},_createAndGetGIF:function(e,t){var n=r._options,a=(n.numFrames,n.interval),s=1e4*a,c=e.cameraStream,d=e.videoElement,u=e.videoWidth,l=e.videoHeight,h=n.gifWidth,m=n.gifHeight,g=f.getCropDimensions({videoWidth:u,videoHeight:l,gifHeight:m,gifWidth:h}),p=t;n.crop=g,n.videoElement=d,n.videoWidth=u,n.videoHeight=l,n.cameraStream=c,o.isElement(d)&&(d.src=o.URL.createObjectURL(c),d.width=h+g.width,d.height=m+g.height,o.setCSSAttr(d,{position:"fixed",opacity:"0"}),i.body.appendChild(d),d.play(),setTimeout(function(){f.getWebcamGif(n,function(e){r.stopVideoStreaming(e),p(e)})},s))}},n=function(e){var t,r,i={};for(t in e)r=e[t],"_"!==t.charAt(0)&&(i[t]=e[t]);return i};"function"==typeof define&&define.amd?define("gifshot",[],function(){return n(r)}):"undefined"!=typeof exports?module.exports=n(r):e.gifshot=n(r)}(l)}(window,window.navigator,document);