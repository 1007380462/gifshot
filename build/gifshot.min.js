!function(e,t,n,o){var i,a,s,c,d,u,l,f;i=function(){var r={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;return e?e.bind(t):e}(),Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder,isObject:function(e){return e?"[object Object]"===Object.prototype.toString.call(e):!1},isArray:function(e){return e?"isArray"in Array?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},isFunction:function(e){return e?"[object Function]"===Object.prototype.toString.call(e):!1},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=n.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},console:function(){var t=e.console;return t&&r.isFunction(t.log)},webworkers:function(){var t=e.Worker;return r.isFunction(t)},blob:function(){return r.Blob}},log:function(){r.isSupported.console()&&console.log.apply(e.console,arguments)},noop:function(){},each:function(e,t){var n,o;if(r.isArray(e))for(n=-1,o=e.length;++n<o&&t(n,e[n])!==!1;);else if(r.isObject(e))for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break},mergeOptions:function o(e,t){if(r.isObject(e)&&r.isObject(t)&&Object.keys){var n={};return r.each(e,function(t){n[t]=e[t]}),r.each(t,function(i){var a=t[i];n[i]=r.isObject(a)&&e[i]?o(e[i],a):a}),n}},setCSSAttr:function(e,t,n){r.isElement(e)&&(r.isString(t)&&r.isString(n)?e.style[t]=n:r.isObject(t)&&r.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){r.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},set:function(t,n){r.isSupported.localStorage()&&e.localStorage.setItem(t,n)},get:function(t){r.isSupported.localStorage()&&e.localStorage.getItem(t)},createWebWorker:function(t){if(!r.isString(t))return{};try{var n=new r.Blob([t],{type:"text/javascript"}),o=e.URL.createObjectURL(n),i=new Worker(o);return{objectUrl:o,worker:i}}catch(a){return{}}}};return r}(),a=function(){return{defaultVideoDimensions:{height:200,width:200},loadedData:!1,findVideoSize:function e(t){var r=t.videoElement,n=t.cameraStream,o=t.completedCallback;r&&(r.videoWidth>0&&r.videoHeight>0?(r.removeEventListener("loadeddata",this.findVideoSize),o({videoElement:r,cameraStream:n,videoWidth:r.videoWidth,videoHeight:r.videoHeight})):e.attempts<10?(e.attempts+=1,setTimeout(e,200)):o({videoElement:r,cameraStream:n,videoWidth:this.defaultVideoDimensions.width,videoHeight:this.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){i.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=this,r=e.videoElement,n=e.cameraStream,o=e.streamedCallback,a=e.completedCallback;o(),r.mozSrcObject?r.mozSrcObject=n:i.URL&&(r.src=i.URL.createObjectURL(n)),r.play(),setTimeout(function s(){s.count=s.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:r,cameraStream:n,completedCallback:a}),t.loadedData=!1):(s.count+=1,s.count>10?t.findVideoSize({videoElement:r,cameraStream:n,completedCallback:a}):s())},100)},startStreaming:function(e){var t=this,r=i.isFunction(e.error)?e.error:i.noop,o=i.isFunction(e.streamed)?e.streamed:i.noop,a=i.isFunction(e.completed)?e.completed:i.noop,s=n.createElement("video"),c=e.lastCameraStream;s.autoplay=!0,s.addEventListener("loadeddata",function(){t.loadedData=!0}),c?t.stream({videoElement:s,cameraStream:c,streamedCallback:o,completedCallback:a}):i.getUserMedia({video:!0},function(e){t.stream({videoElement:s,cameraStream:e,streamedCallback:o,completedCallback:a})},r)},startVideoStreaming:function(e,t){t=t||{};var r,n=this,i=t.timeout!==o?t.timeout:0,a=t.callback;i>0&&(r=setTimeout(function(){n.onStreamingTimeout(a)},1e4)),this.startStreaming({error:function(){a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(t){var r=this.cameraStream=t.cameraStream,n=this.videoElement=t.videoElement,o=t.videoWidth,i=t.videoHeight;e({cameraStream:r,videoElement:n,videoWidth:o,videoHeight:i})},lastCameraStream:t.lastCameraStream})},stopVideoStreaming:function(e){e=i.isObject(e)?e:{};var t=e.cameraStream,r=e.videoElement,n=e.keepCameraOn;!n&&t&&i.isFunction(t.stop)&&t.stop(),i.isElement(r)&&(r.pause(),i.isFunction(i.URL.revokeObjectURL)&&i.URL.revokeObjectURL(r.src),i.removeElement(r))}}}(),s=function(){var e=function(){function e(e,t,r){for(var n=0,o=t*r*4,i=[];o>n;)i.push(e[n++]),i.push(e[n++]),i.push(e[n++]),n++;return i}function t(e){for(var t=[],r=0;r<e.length;r+=3){var n=e[r],o=e[r+1],i=e[r+2];t.push(n<<16|o<<8|i)}return t}function n(n,o,a,s){for(var c=e(n,o,a),d=new i(c,c.length,s),u=d.process(),l=new Uint32Array(t(u)),f=o*a,m=new Uint8Array(f),h=0,p=0;f>p;p++)r=c[h++],g=c[h++],b=c[h++],m[p]=d.map(r,g,b);return{pixels:m,palette:l}}function o(e){var t=e.width,r=e.height,o=e.data,i=(e.palette,e.sampleInterval);return n(o,t,r,i)}function i(){function e(e,t,r){var n,o;for(l=e,f=t,m=r,h=new Array(g),n=0;g>n;n++)h[n]=new Array(4),o=h[n],o[0]=o[1]=o[2]=(n<<k+8)/g|0,z[n]=F/g|0,V[n]=0}function t(){for(var e=[],t=new Array(g),r=0;g>r;r++)t[h[r][3]]=r;for(var n=0,o=0;g>o;o++){var i=t[o];e[n++]=h[i][0],e[n++]=h[i][1],e[n++]=h[i][2]}return e}function r(){var e,t,r,n,o,i,a,s;for(a=0,s=0,e=0;g>e;e++){for(o=h[e],r=e,n=o[1],t=e+1;g>t;t++)i=h[t],i[1]<n&&(r=t,n=i[1]);if(i=h[r],e!=r&&(t=i[0],i[0]=o[0],o[0]=t,t=i[1],i[1]=o[1],o[1]=t,t=i[2],i[2]=o[2],o[2]=t,t=i[3],i[3]=o[3],o[3]=t),n!=a){for(P[a]=s+e>>1,t=a+1;n>t;t++)P[t]=e;a=n,s=e}}for(P[a]=s+y>>1,t=a+1;256>t;t++)P[t]=y}function n(){var e,t,r,n,o,i,a,h,g,y,C,F,W,M;for(S>f&&(m=1),u=30+(m-1)/3,F=l,W=0,M=f,C=f/(3*m),y=C/U|0,h=x,i=H,a=i>>E,1>=a&&(a=0),e=0;a>e;e++)_[e]=h*((a*a-e*e)*B/(a*a));for(g=S>f?3:f%p!==0?3*p:f%v!==0?3*v:f%b!==0?3*b:3*w,e=0;C>e;)if(r=(255&F[W+0])<<k,n=(255&F[W+1])<<k,o=(255&F[W+2])<<k,t=d(r,n,o),c(h,t,r,n,o),0!==a&&s(a,t,r,n,o),W+=g,W>=M&&(W-=f),e++,0===y&&(y=1),e%y===0)for(h-=h/u,i-=i/L,a=i>>E,1>=a&&(a=0),t=0;a>t;t++)_[t]=h*((a*a-t*t)*B/(a*a))}function o(e,t,r){var n,o,i,a,s,c,d;for(s=1e3,d=-1,n=P[t],o=n-1;g>n||o>=0;)g>n&&(c=h[n],i=c[1]-t,i>=s?n=g:(n++,0>i&&(i=-i),a=c[0]-e,0>a&&(a=-a),i+=a,s>i&&(a=c[2]-r,0>a&&(a=-a),i+=a,s>i&&(s=i,d=c[3])))),o>=0&&(c=h[o],i=t-c[1],i>=s?o=-1:(o--,0>i&&(i=-i),a=c[0]-e,0>a&&(a=-a),i+=a,s>i&&(a=c[2]-r,0>a&&(a=-a),i+=a,s>i&&(s=i,d=c[3]))));return d}function i(){return n(),a(),r(),t()}function a(){var e;for(e=0;g>e;e++)h[e][0]>>=k,h[e][1]>>=k,h[e][2]>>=k,h[e][3]=e}function s(e,t,r,n,o){var i,a,s,c,d,u,l;for(s=t-e,-1>s&&(s=-1),c=t+e,c>g&&(c=g),i=t+1,a=t-1,u=1;c>i||a>s;){if(d=_[u++],c>i){l=h[i++];try{l[0]-=d*(l[0]-r)/G|0,l[1]-=d*(l[1]-n)/G|0,l[2]-=d*(l[2]-o)/G|0}catch(f){}}if(a>s){l=h[a--];try{l[0]-=d*(l[0]-r)/G|0,l[1]-=d*(l[1]-n)/G|0,l[2]-=d*(l[2]-o)/G|0}catch(f){}}}}function c(e,t,r,n,o){var i=h[t],a=e/x;i[0]-=a*(i[0]-r)|0,i[1]-=a*(i[1]-n)|0,i[2]-=a*(i[2]-o)|0}function d(e,t,r){var n,o,i,a,s,c,d,u,l,f;for(u=~(1<<31),l=u,c=-1,d=c,n=0;g>n;n++)f=h[n],o=f[0]-e,0>o&&(o=-o),i=f[1]-t,0>i&&(i=-i),o+=i,i=f[2]-r,0>i&&(i=-i),o+=i,u>o&&(u=o,c=n),a=o-(V[n]>>C-k),l>a&&(l=a,d=n),s=z[n]>>M,z[n]-=s,V[n]+=s<<W;return z[c]+=O,V[c]-=j,d}var u,l,f,m,h,g=256,p=499,v=491,b=487,w=503,S=3*w,y=g-1,k=4,U=100,C=16,F=1<<C,W=10,M=10,O=F>>M,j=F<<W-M,A=g>>3,E=6,I=1<<E,H=A*I,L=30,R=10,x=1<<R,T=8,B=1<<T,D=R+T,G=1<<D,P=[],V=[],z=[],_=[];e.apply(this,arguments);var N={};return N.map=o,N.process=i,N}self.onmessage=function(e){var t=e.data,r=o(t);postMessage(r)}},t=e.toString()+"worker();";return t}(),c=function(){function e(e,r,n,i){function a(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var s=0;i=i===o?{}:i;var c=i.loop===o?null:i.loop,d=i.palette===o?null:i.palette;if(0>=r||0>=n||r>65535||n>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var u=0,l=0;if(null!==d){for(var f=a(d);f>>=1;)++u;if(f=1<<u,--u,i.background!==o){if(l=i.background,l>=f)throw"Background index out of range.";if(0===l)throw"Background index explicitly passed as 0."}}if(e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=(null!==d?128:0)|u,e[s++]=l,e[s++]=0,null!==d)for(var m=0,h=d.length;h>m;++m){var g=d[m];e[s++]=g>>16&255,e[s++]=g>>8&255,e[s++]=255&g}if(null!==c){if(0>c||c>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=0}var p=!1;this.addFrame=function(r,n,i,c,u,l){if(p===!0&&(--s,p=!1),l=l===o?{}:l,0>r||0>n||r>65535||n>65535)throw"x/y invalid.";if(0>=i||0>=c||i>65535||c>65535)throw"Width/Height invalid.";if(u.length<i*c)throw"Not enough pixels for the frame size.";var f=!0,m=l.palette;if((m===o||null===m)&&(f=!1,m=d),m===o||null===m)throw"Must supply either a local or global palette.";for(var h=a(m),g=0;h>>=1;)++g;h=1<<g;var v=l.delay===o?0:l.delay,b=l.disposal===o?0:l.disposal;if(0>b||b>3)throw"Disposal out of range.";var w=!1,S=0;if(l.transparent!==o&&null!==l.transparent&&(w=!0,S=l.transparent,0>S||S>=h))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(w===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=S,e[s++]=0),e[s++]=44,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=255&i,e[s++]=i>>8&255,e[s++]=255&c,e[s++]=c>>8&255,e[s++]=f===!0?128|g-1:0,f===!0)for(var y=0,k=m.length;k>y;++y){var U=m[y];e[s++]=U>>16&255,e[s++]=U>>8&255,e[s++]=255&U}s=t(e,s,2>g?2:g,u)},this.end=function(){return p===!1&&(e[s++]=59,p=!0),s}}function t(e,t,r,n){function i(r){for(;m>=r;)e[t++]=255&h,h>>=8,m-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){h|=e<<m,m+=f,i(8)}e[t++]=r;var s=t++,c=1<<r,d=c-1,u=c+1,l=u+1,f=r+1,m=0,h=0,g=n[0]&d,p={};a(c);for(var v=1,b=n.length;b>v;++v){var w=n[v]&d,S=g<<8|w,y=p[S];if(y===o){for(h|=g<<m,m+=f;m>=8;)e[t++]=255&h,h>>=8,m-=8,t===s+256&&(e[s]=255,s=t++);4096===l?(a(c),l=u+1,f=r+1,p={}):(l>=1<<f&&++f,p[S]=l++),g=w}else g=y}return a(g),a(u),i(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}return e}(),d=function(e){function t(t){function r(){if(0===j.length)throw"No workers left!";return j.pop()}function o(e){j.push(e)}function a(e){C.length;W=e;for(var t=0;m>t&&t<C.length;t++)s(t)}function s(e){var t,n;return t=C[e],t.beingProcessed||t.done?(console.error("Frame already being processed or done!",t.position),void u()):(t.sampleInterval=f,t.beingProcessed=!0,n=r(),n.onmessage=function(e){var r=e.data;delete t.data,t.pixels=Array.prototype.slice.call(r.pixels),t.palette=Array.prototype.slice.call(r.palette),t.done=!0,t.beingProcessed=!1,o(n),u()},void n.postMessage(t))}function d(){for(var e=-1,t=0;t<C.length;t++){var r=C[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&s(e)}function u(){var e=C.every(function(e){return!e.beingProcessed&&e.done});F++,M(.75*F/C.length),e?A||l(C,W):setTimeout(d,1)}function l(e,t){var r,n=[],o={loop:k};null!==b&&null!==w&&(r=w,o.palette=r);var i=new g(n,p,v,o);A=!0,e.forEach(function(t){var n;r||(n=t.palette),M(.75+.25*t.position*1/e.length),i.addFrame(0,0,p,v,t.pixels,{palette:n,delay:U})}),i.end(),M(1),e=[],A=!1,t(n)}var f,m,h,g=c,p=t.width||160,v=t.height||120,b=t.dithering||null,w=t.palette||null,S=null,y=null,k=0,U=250,C=[],F=0,W=function(){},M=function(){},O=[],j=[],A=!1;t=t||{},f=t.sampleInterval||10,m=t.numWorkers||2,h=t.workerPath||"Animated_GIF.worker.js";for(var E=0;m>E;E++){var I=i.createWebWorker(e),H=I.objectUrl,L=I.worker;O.push({worker:L,objectUrl:H}),j.push(L)}var R=function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return function(t){for(var r=t.length,n="",o=0;r>o;o++)n+=e[t[o]];return n}}();this.setSize=function(e,t){p=e,v=t,S=n.createElement("canvas"),S.width=e,S.height=t,y=S.getContext("2d")},this.setDelay=function(e){U=.1*e},this.setRepeat=function(e){k=e},this.addFrame=function(e){null===y&&this.setSize(p,v),y.drawImage(e,0,0,p,v);var t=y.getImageData(0,0,p,v);this.addFrameImageData(t)},this.addFrameImageData=function(e){var t=(e.length,new Uint8Array(e.data));C.push({data:t,width:e.width,height:e.height,palette:w,dithering:b,done:!1,beingProcessed:!1,position:C.length})},this.onRenderProgress=function(e){M=e},this.isRendering=function(){return A},this.getBase64GIF=function(e){var t=function(t){var r=R(t),n="data:image/gif;base64,"+btoa(r);e(n)};a(t)},this.getBlobGIF=function(e){var t=function(t){var r=new Uint8Array(t),n=new Blob([r],{type:"image/gif"});e(n)};a(t)},this.destroy=function(){O.forEach(function(e){var t=e.worker,r=e.objectUrl;t.terminate(),i.URL.revokeObjectURL(r)})}}return t}(s),u=function(e){return{getWebcamGif:function(t,r){r=i.isFunction(r)?r:function(){};var a,s=n.createElement("canvas"),c=t.videoElement,d=t.cameraStream,u=t.gifWidth,l=t.gifHeight,f=t.videoWidth,m=t.videoHeight,h=t.sampleInterval,g=t.numWorkers,p=t.crop,v=t.interval,b=t.progressCallback,w=t.numFrames,S=w,y=new e({sampleInterval:h,numWorkers:g}),k=Math.floor(p.scaledWidth/2),U=f-p.scaledWidth,C=Math.floor(p.scaledHeight/2),F=m-p.scaledHeight,W=function(){var e=S-1;a.drawImage(c,k,C,U,F,0,0,u,l),y.addFrameImageData(a.getImageData(0,0,u,l)),S=e,b((w-S)/w),e>0&&setTimeout(W,1e3*v),S||y.getBase64GIF(function(e){y.destroy(),r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:d,videoElement:c})})};w=w!==o?w:3,v=v!==o?v:.1,s.width=u,s.height=l,a=s.getContext("2d"),y.setSize(u,l),y.setDelay(v),W()},getCropDimensions:function(e){var t=e.videoWidth,r=e.videoHeight,n=e.gifWidth,o=e.gifHeight,i={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(i.width=Math.round(t*(o/r))-n,i.scaledWidth=Math.round(i.width*(r/o))):(i.height=Math.round(r*(n/t))-o,i.scaledHeight=Math.round(i.height*(t/n))),i}}}(d),l=function(){var t={validate:function(){var e={};return i.each(t.validators,function(t,r){return r.condition?void 0:(e=r,e.error=!0,!1)}),delete e.condition,e},isValid:function(){var e=t.validate(),r=e.error!==!0?!0:!1;return r},validators:[{condition:i.isFunction(i.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:i.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:i.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:i.isFunction(i.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:i.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:i.isFunction(e.btoa),errorCode:"window.btoa",errorMsg:"The window.btoa base-64 encoding method is not supported in your browser"},{condition:i.isFunction(Uint8Array),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:i.isFunction(Uint32Array),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}]};return t}(),f=function(t){var r={_defaultOptions:{sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,progressCallback:function(){},completeCallback:function(){}},_options:{},animated_GIF:t,createGIF:function(e,t){if(t=i.isFunction(e)?e:t,e=i.isObject(e)?e:{},i.isFunction(t)){if(!r.isSupported())return t(l.validate());var n=r._defaultOptions,o=(r._options=i.mergeOptions(n,e),e.cameraStream);a.startVideoStreaming(function(e){r._createAndGetGIF(e,t)},{lastCameraStream:o,callback:t})}},takeSnapShot:function(e,t){var n=i.mergeOptions(r._defaultOptions,e),o=i.mergeOptions(n,{interval:.1,numFrames:1});this.createGIF(o,t)},stopVideoStreaming:function(e){e=i.isObject(e)?e:{};var t=i.isObject(r._options)?r._options:{},n=e.cameraStream,o=e.videoElement;a.stopVideoStreaming({cameraStream:n,videoElement:o,keepCameraOn:t.keepCameraOn})},isSupported:function(){return l.isValid()},_createAndGetGIF:function(e,t){var o=r._options,a=(o.numFrames,o.interval),s=1e4*a,c=e.cameraStream,d=e.videoElement,l=e.videoWidth,f=e.videoHeight,m=o.gifWidth,h=o.gifHeight,g=u.getCropDimensions({videoWidth:l,videoHeight:f,gifHeight:h,gifWidth:m}),p=t;o.crop=g,o.videoElement=d,o.videoWidth=l,o.videoHeight=f,o.cameraStream=c,i.isElement(d)&&(d.src=i.URL.createObjectURL(c),d.width=m+g.width,d.height=h+g.height,i.setCSSAttr(d,{position:"absolute",width:m+g.videoWidth+"px",height:h+g.videoHeight+"px",left:-Math.floor(g.videoWidth/2)+"px",top:-Math.floor(g.videoHeight/2)+"px",opacity:"0"}),n.body.appendChild(d),d.play(),setTimeout(function(){u.getWebcamGif(o,function(e){r.stopVideoStreaming(e),p(e)})},s))}},o=function(e){var t,r,n={};for(t in e)r=e[t],"_"!==t.charAt(0)&&(n[t]=e[t]);return n};"function"==typeof define&&define.amd?define("gifshot",[],function(){return o(r)}):"undefined"!=typeof exports?module.exports=o(r):e.gifshot=o(r)}(d)}(window,window.navigator,document);